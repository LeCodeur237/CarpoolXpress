import{_ as e}from"./VLoader.vue_vue_type_style_index_0_lang-CaAf6-TF.js";import{_ as l}from"./VModal.vue_vue_type_style_index_0_lang-DpzmKgD9.js";import{_ as a}from"./VTags.vue_vue_type_script_setup_true_lang-9QT0YwZt.js";import{_ as s}from"./VTag.vue_vue_type_style_index_0_lang-Ccs_Zx16.js";import{_ as t}from"./VFlexPagination.vue_vue_type_script_setup_true_lang-B_KnP90u.js";import{a as n,_ as i}from"./VFlexTable.vue_vue_type_style_index_0_lang-CUOnJVmK.js";import{_ as o}from"./VButtons.vue_vue_type_script_setup_true_lang-BFpncuD1.js";import{_ as r}from"./VButton.vue_vue_type_style_index_0_lang-5A9YLZjy.js";import{_ as u}from"./VAvatar.vue_vue_type_style_index_0_lang-A1XDdLuK.js";import{_ as c}from"./VPlaceholderPage.vue_vue_type_style_index_0_lang-Dg8IbSZ2.js";import{e as d,r as m,Q as p,w as v,o as g,t as _,J as f,I as y,n as w,x as h,Y as V,a4 as C,z as x,H as k,v as b,S as R,y as P,L as S,R as A,a7 as D,V as j,m as N,a1 as I,a2 as T}from"./index-DS7wE-jD.js";import{_ as U,a as L}from"./search-4-dark-Cl7pfQev.js";import{u as G}from"./viewWrapper-C2STndyf.js";import{u as B}from"./defaultResource-BoNHVbB6.js";import{u as F}from"./useNotyf-BdZ2Z_wX.js";import{b as $}from"./route-block-B_A1xBdJ.js";import{_ as z}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./VFlex.vue_vue_type_style_index_0_lang-B3O-4R9P.js";import"./useFetch-BWOPolYv.js";import"./notyf-B8_S_SnG.js";const E=["ViewDashboard"],H=["ViewTrips","ViewTripsList","ViewTripsNegociations","ViewTripsReports","ViewTripsPricingDiscount"],M=["Viewcarpoolers","ViewcarpoolersList","ViewcarpoolersReports","ViewcarpoolersReferrals"],O=["ViewAccounting","ViewAccountBoard","ViewBankAccounts","ViewAccountPayments","ViewAccountPaymentsList","ViewAccountPaymentsDriverPayouts","ViewAccountPaymentsRefunds","ViewAccountVouchers","ViewAccountReferrals"],W=["ViewSettingsGeneral","ViewSettingsGeneralCurrency","ViewSettingsGeneralLanguage","ViewSettingsGeneralTaxFees","ViewSettingsGeneralAdmin","ViewSettingsUsers","ViewSettingsUsersList","ViewSettingsUsersPermissions","ViewSettingsNotifications","ViewSettingsNotificationsList","ViewSettingsNotificationsTemplates","ViewSettingsBillingPayment","ViewSettingsPaymentSettings","ViewSettingsInvoiceTemplates","ViewSettingsRefundPolicy","ViewSettingsReferralRewards","ViewSettingsReferralProgram","ViewSettingsVoucherCoupons","ViewSettingsLoyaltyProgram","ViewSettingsAccount"],q={Dashboard:E,Trips:H,Carpoolers:M,Accounting:O,Settings:W},J=new Set([...E,...H,...M,...O,...W]);Array.from(J);const Q=e=>(I("data-v-f2d79ae6"),e=e(),T(),e),X={class:"list-flex-toolbar flex-list-v1"},Y={class:"search-widget ml-4",style:{width:"300px"}},K={class:"field"},Z={class:"control"},ee=["disabled"],le=[Q((()=>h("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:search"},null,-1)))],ae={class:"page-content-inner"},se={class:"flex-list-wrapper flex-list-v1"},te=Q((()=>h("img",{class:"light-image",src:U,alt:""},null,-1))),ne=Q((()=>h("img",{class:"dark-image",src:L,alt:""},null,-1))),ie={class:"item-name dark-inverted"},oe={class:"item-meta"},re={class:"item-meta"},ue={class:"light-text"},ce={class:"infos truncated-cell-content"},de={class:"light-text"},me={class:"light-text"},pe=Q((()=>h("br",null,null,-1))),ve={key:0,style:{"text-align":"center"}},ge=Q((()=>h("br",null,null,-1))),_e={class:"columns"},fe={class:"column is-6"},ye=Q((()=>h("h1",null,"All Roles",-1))),we=Q((()=>h("hr",null,null,-1))),he={class:"collapse-container"},Ve=["onClick"],Ce={key:0,class:"fa fa-plus","aria-hidden":"true"},xe={key:1,class:"fa fa-minus","aria-hidden":"true"},ke={key:0,class:"collapse-content"},be={class:"column is-6"},Re=Q((()=>h("hr",null,null,-1))),Pe={key:1},Se=[Q((()=>h("p",null,"No user selected.",-1)))],Ae=d({__name:"permissions",setup(d){const I=G(),T=B(),U=F(),L=m(!1),$=m(!1),z=m(""),E=m({page:1,itemsPerPage:6,totalItems:0}),H=m(!1),M=m(!1),O=m([]),W=m(null),J=m([]),Q=m(null),Ae=e=>{J.value.includes(e)?U.warning(`Role "${e}" is already selected.`):J.value.push(e)},De=()=>{H.value=!1,J.value=[],W.value=null,M.value=!1,z.value="",Te()},je={names:{label:"Names",grow:!0,media:!0},rule:"Roles",department:"Department",actions:{label:"Actions",align:"center"}},Ne=p((()=>{let e=O.value;if(z.value){const l=new RegExp(z.value,"i");e=O.value.filter((e=>null!==e.userDetailConsole?.fullName?.match(l)||null!==e.email?.match(l)||null!==e.userDetailConsole?.departmentRole?.match(l)||null!==e.userDetailConsole?.department?.match(l)))}E.value.totalItems=e.length;const{page:l,itemsPerPage:a}=E.value,s=(l-1)*a,t=s+a;return e.slice(s,t)})),Ie=(e,l)=>e?e.length>l?e.slice(0,l)+"...":e:"",Te=async()=>{try{L.value=!0;const e=await T.list("/ConsoleUser/GetAll");await w(),e&&Array.isArray(e)?(O.value=e.map((e=>({...e}))),E.value.totalItems=e.length):(O.value=[],E.value.totalItems=0,U.warning("Could not fetch user list or invalid response format."))}catch(e){console.error("An error has occurred: ",e),O.value=[],E.value.totalItems=0}finally{L.value=!1}},Ue=e=>{e!==E.value.page&&(E.value.page=e)};return v(z,(()=>{E.value.page=1})),g((async()=>{I.setPageTitle("Roles & Permissions"),await Te()})),(d,m)=>{const p=c,v=u,g=n,w=r,I=o,G=i,B=t,F=s,O=a,Te=l,Le=e;return _(),f(Le,{size:"xl",active:L.value,class:"full-height"},{default:y((()=>[h("div",null,[h("div",X,[h("div",Y,[h("div",K,[h("div",Z,[V(h("input",{"onUpdate:modelValue":m[0]||(m[0]=e=>z.value=e),type:"text",class:"input",placeholder:"Rechercher..."},null,512),[[C,z.value]]),h("button",{class:"search-button",disabled:z.value.length<1},le,8,ee)])])])]),h("div",ae,[h("div",se,[Ne.value.length||L.value?x("",!0):(_(),f(p,{key:0,title:"We couldn't find any matching results.",subtitle:"Too bad. Looks like we couldn't find any matching results for the\r\n              search terms you've entered. Please try different search terms or\r\n              criteria.",larger:""},{image:y((()=>[te,ne])),_:1})),Ne.value.length?(_(),f(G,{key:1,data:Ne.value,columns:je,rounded:""},{body:y((()=>[k(D,{name:"list",tag:"div",class:"flex-list-inner"},{default:y((()=>[(_(!0),b(A,null,R(Ne.value,(e=>(_(),b("div",{key:e.id,class:"flex-table-item"},[k(g,{column:{media:!0,grow:!0},"data-th":"Label"},{default:y((()=>[k(v,{initials:e.userDetailConsole?.fullName?e.userDetailConsole.fullName[0]+(e.userDetailConsole.fullName[1]||""):"",squared:"",size:"large"},null,8,["initials"]),h("div",null,[h("span",ie,P(Ie(e.userDetailConsole?.fullName,15)),1),h("span",oe,[h("span",null,P(Ie(e.email,25)),1)]),h("span",re,[h("span",null,P(Ie(e.phoneNumber,25)),1)])])])),_:2},1024),k(g,null,{default:y((()=>[h("span",ue,P(Ie(e.consoleRole,25)),1)])),_:2},1024),k(g,null,{default:y((()=>[h("div",ce,[h("span",de,[h("b",null,P(Ie(e.userDetailConsole?.department,25)),1)]),h("span",me,[S("Role : "),h("b",null,P(Ie(e.userDetailConsole?.departmentRole?e.userDetailConsole.departmentRole:"",20)),1)])])])),_:2},1024),k(g,{column:{align:"center"}},{default:y((()=>[k(I,null,{default:y((()=>[k(w,{color:"success",outlined:"",circle:"",icon:"lucide:pencil",onClick:l=>(async e=>{try{M.value=!0;const l=await T.find("/ConsoleUser/GetById",`?userid=${e}`);W.value=l,H.value=!0,W.value?.roleList?.forEach((e=>{Ae(e)}))}catch(l){console.error("Error fetching user by ID :",l)}finally{M.value=!1}})(e.id)},{default:y((()=>[S(" Change permissions ")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])))),128))])),_:1})])),_:1},8,["data"])):x("",!0),!L.value&&E.value.totalItems>E.value.itemsPerPage?(_(),f(B,{key:2,"current-page":E.value.page,"onUpdate:currentPage":[m[1]||(m[1]=e=>E.value.page=e),Ue],"item-per-page":E.value.itemsPerPage,"total-items":E.value.totalItems,"max-links-displayed":6,"no-router":""},null,8,["current-page","item-per-page","total-items"])):x("",!0)])]),pe,k(Te,{open:H.value,size:"big",actions:"center",title:"Adding Roles to User",noclose:!0,loading:M.value,"cancel-label":"Cancel",onClose:m[3]||(m[3]=e=>De())},{content:y((()=>[W.value?(_(),b("div",ve,[k(v,{initials:W.value.userDetailConsole?.fullName?W.value.userDetailConsole.fullName[0]+(W.value.userDetailConsole.fullName[1]||""):"",size:"large"},null,8,["initials"]),h("p",null,[h("strong",null,P(W.value.userDetailConsole?.fullName),1)]),h("p",null,[h("strong",null,P(W.value.email),1)]),h("p",null,P(W.value.userDetailConsole?.departmentRole),1),ge,h("div",_e,[h("div",fe,[ye,we,h("div",he,[(_(!0),b(A,null,R(N(q),((e,l)=>(_(),b("div",{key:l,class:"collapse-item"},[h("button",{class:"toggle-btn",onClick:e=>{return a=l,void(Q.value=Q.value===a?null:a);var a}},[S(P((Q.value,`${l}`))+" ",1),Q.value!==l?(_(),b("i",Ce)):x("",!0),Q.value===l?(_(),b("i",xe)):x("",!0)],8,Ve),k(j,{name:"slide"},{default:y((()=>[Q.value===l?(_(),b("div",ke,[k(O,null,{default:y((()=>[(_(!0),b(A,null,R(e,(e=>(_(),f(F,{key:e,rounded:"",class:"roleItem",color:"success",onClick:l=>Ae(e)},{default:y((()=>[S(P(e),1)])),_:2},1032,["onClick"])))),128))])),_:2},1024)])):x("",!0)])),_:2},1024)])))),128))])]),h("div",be,[h("h1",null,P(W.value.userDetailConsole?.fullName)+" Roles",1),Re,k(O,null,{default:y((()=>[(_(!0),b(A,null,R(J.value,(e=>(_(),f(F,{key:e,color:"success",rounded:"",class:"roleItem",onClick:l=>(async e=>{J.value.includes(e)?(J.value.splice(J.value.indexOf(e),1),U.success(`Role "${e}" is removed.`)):U.warning(`Role "${e}" is not selected.`)})(e)},{default:y((()=>[S(P(e),1)])),_:2},1032,["onClick"])))),128))])),_:1})])])])):(_(),b("div",Pe,Se))])),action:y((()=>[k(w,{color:"primary",raised:"",loading:$.value,disabled:!J.value.length,onClick:m[2]||(m[2]=e=>(async()=>{$.value=!0;try{if(W.value){const e=await T.updateRoles("/ConsoleUser/ManageRole?id="+W.value.id,J.value);e?(U.success("User roles updated successfully!"),console.log("User roles updated successfully!"+e),De()):(U.error("Failed to update user roles. API returned unsuccessful."),console.error("API call to update roles was unsuccessful:",e))}else U.warning("No user selected to update roles for."),console.warn("updateRoles called without a selected user.")}catch(e){U.error(`Error updating user roles: ${e.message||"Unknown error"}`),console.error("Error updating user roles:",e)}finally{$.value=!1}})())},{default:y((()=>[S(" Update role ")])),_:1},8,["loading","disabled"])])),_:1},8,["open","loading"])])])),_:1},8,["active"])}}});"function"==typeof $&&$(Ae);const De=z(Ae,[["__scopeId","data-v-f2d79ae6"]]);export{De as default};
