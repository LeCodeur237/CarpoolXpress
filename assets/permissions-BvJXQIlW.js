import{_ as e}from"./VLoader.vue_vue_type_style_index_0_lang-z6CWX0dI.js";import{_ as l}from"./VModal.vue_vue_type_style_index_0_lang-BxprIClF.js";import{_ as a}from"./VTags.vue_vue_type_script_setup_true_lang-BS0u4dJP.js";import{_ as s}from"./VTag.vue_vue_type_style_index_0_lang-EAZmVvoA.js";import{_ as t}from"./VFlexPagination.vue_vue_type_script_setup_true_lang-DRRY7dtM.js";import{a as n,_ as i}from"./VFlexTable.vue_vue_type_style_index_0_lang-Cm_KVmI6.js";import{_ as o}from"./VButtons.vue_vue_type_script_setup_true_lang-BRkjIdnO.js";import{_ as r}from"./VButton.vue_vue_type_style_index_0_lang-BOJu42_j.js";import{_ as u}from"./VAvatar.vue_vue_type_style_index_0_lang-DpyihaF2.js";import{_ as c}from"./VPlaceholderPage.vue_vue_type_style_index_0_lang-B_FLCEd8.js";import{_ as d}from"./VField.vue_vue_type_script_setup_true_lang-CWrb41Pw.js";import{_ as m}from"./VControl-CsOLD0Mp.js";import{e as p,r as v,Q as g,w as _,o as f,t as y,J as w,I as V,n as h,x as C,H as k,Y as x,a4 as P,z as R,v as S,S as b,y as D,L as A,R as j,a6 as N,V as I,m as T,a1 as U,a2 as L}from"./index-DCVzCXGO.js";import{_ as G,a as B}from"./search-4-dark-Cl7pfQev.js";import{u as F}from"./viewWrapper-B2fmsTqy.js";import{u as z}from"./defaultResource-BKcbMEp6.js";import{u as E}from"./useNotyf-1WfirvEN.js";import{b as W}from"./route-block-B_A1xBdJ.js";import{_ as $}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./useFetch-DTVXwznz.js";import"./notyf-CueL1e6X.js";const M=["ViewDashboard"],Y=["ViewTrips","ViewTripsList","ViewTripsNegociations","ViewTripsReports","ViewTripsPricingDiscount"],q=["Viewcarpoolers","ViewcarpoolersList","ViewcarpoolersReports","ViewcarpoolersReferrals"],H=["ViewAccounting","ViewAccountBoard","ViewBankAccounts","ViewAccountPayments","ViewAccountPaymentsList","ViewAccountPaymentsDriverPayouts","ViewAccountPaymentsRefunds","ViewAccountVouchers","ViewAccountReferrals"],J=["ViewSettingsGeneral","ViewSettingsGeneralCurrency","ViewSettingsGeneralLanguage","ViewSettingsGeneralTaxFees","ViewSettingsGeneralAdmin","ViewSettingsUsers","ViewSettingsUsersList","ViewSettingsUsersPermissions","ViewSettingsNotifications","ViewSettingsNotificationsList","ViewSettingsNotificationsTemplates","ViewSettingsBillingPayment","ViewSettingsPaymentSettings","ViewSettingsInvoiceTemplates","ViewSettingsRefundPolicy","ViewSettingsReferralRewards","ViewSettingsReferralProgram","ViewSettingsVoucherCoupons","ViewSettingsLoyaltyProgram","ViewSettingsAccount"],O={Dashboard:M,Trips:Y,Carpoolers:q,Accounting:H,Settings:J},Q=new Set([...M,...Y,...q,...H,...J]);Array.from(Q);const K=e=>(U("data-v-a40a8f01"),e=e(),L(),e),X={class:"list-flex-toolbar flex-list-v1"},Z={class:"page-content-inner"},ee={class:"flex-list-wrapper flex-list-v1"},le=K((()=>C("img",{class:"light-image",src:G,alt:""},null,-1))),ae=K((()=>C("img",{class:"dark-image",src:B,alt:""},null,-1))),se={class:"item-name dark-inverted"},te={class:"item-meta"},ne={class:"light-text"},ie={class:"infos truncated-cell-content"},oe={class:"light-text"},re={class:"light-text"},ue=K((()=>C("br",null,null,-1))),ce={key:0,style:{"text-align":"center"}},de=K((()=>C("br",null,null,-1))),me={class:"columns"},pe={class:"column is-6"},ve=K((()=>C("h1",null,"All Roles",-1))),ge=K((()=>C("hr",null,null,-1))),_e={class:"collapse-container"},fe=["onClick"],ye={key:0,class:"fa fa-plus","aria-hidden":"true"},we={key:1,class:"fa fa-minus","aria-hidden":"true"},Ve={key:0,class:"collapse-content"},he={class:"column is-6"},Ce=K((()=>C("hr",null,null,-1))),ke={key:1},xe=[K((()=>C("p",null,"No user selected.",-1)))],Pe=p({__name:"permissions",setup(p){const U=F(),L=z(),G=E(),B=v(!1),W=v(!1),$=v(""),M=v({page:1,itemsPerPage:5,totalItems:0}),Y=v(!1),q=v(!1),H=v([]),J=v(null),Q=v([]),K=v(null),Pe=e=>{Q.value.includes(e)||Q.value.push(e)},Re=()=>{Y.value=!1,Q.value=[],J.value=null,q.value=!1,$.value="",Ae()},Se={names:{label:"Names",grow:!0,media:!0},rule:"Roles",department:"Department",actions:{label:"Actions",align:"center"}},be=g((()=>{let e=H.value;if($.value){const l=new RegExp($.value,"i");e=H.value.filter((e=>null!==e.userDetailConsole?.fullName?.match(l)||null!==e.email?.match(l)||null!==e.userDetailConsole?.departmentRole?.match(l)||null!==e.userDetailConsole?.department?.match(l)))}M.value.totalItems=e.length;const{page:l,itemsPerPage:a}=M.value,s=(l-1)*a,t=s+a;return e.slice(s,t)})),De=(e,l)=>e?e.length>l?e.slice(0,l)+"...":e:"",Ae=async()=>{try{B.value=!0;const e=await L.list("/ConsoleUser/GetAll");await h(),e&&Array.isArray(e)?(H.value=e.map((e=>({...e}))),M.value.totalItems=e.length):(H.value=[],M.value.totalItems=0,G.warning("Could not fetch user list or invalid response format."))}catch(e){console.error("An error has occurred: ",e),H.value=[],M.value.totalItems=0}finally{B.value=!1}},je=e=>{e!==M.value.page&&(M.value.page=e)};return _($,(()=>{M.value.page=1})),f((async()=>{U.setPageTitle("Roles & Permissions"),await Ae()})),(p,v)=>{const g=m,_=d,f=c,h=u,U=n,F=r,z=o,E=i,H=t,Ae=s,Ne=a,Ie=l,Te=e;return y(),w(Te,{size:"xl",active:B.value,class:"full-height"},{default:V((()=>[C("div",null,[C("div",X,[k(_,null,{default:V((()=>[k(g,{icon:"feather:search"},{default:V((()=>[x(C("input",{"onUpdate:modelValue":v[0]||(v[0]=e=>$.value=e),class:"input custom-text-filter",placeholder:"Search..."},null,512),[[P,$.value]])])),_:1})])),_:1})]),C("div",Z,[C("div",ee,[be.value.length||B.value?R("",!0):(y(),w(f,{key:0,title:"We couldn't find any matching results.",subtitle:"Too bad. Looks like we couldn't find any matching results for the\n              search terms you've entered. Please try different search terms or\n              criteria.",larger:""},{image:V((()=>[le,ae])),_:1})),be.value.length?(y(),w(E,{key:1,data:be.value,columns:Se,rounded:""},{body:V((()=>[k(N,{name:"list",tag:"div",class:"flex-list-inner"},{default:V((()=>[(y(!0),S(j,null,b(be.value,(e=>(y(),S("div",{key:e.id,class:"flex-table-item"},[k(U,{column:{media:!0,grow:!0},"data-th":"Label"},{default:V((()=>[k(h,{initials:e.userDetailConsole?.fullName?e.userDetailConsole.fullName[0]+(e.userDetailConsole.fullName[1]||""):"",squared:"",size:"large"},null,8,["initials"]),C("div",null,[C("span",se,D(e.userDetailConsole?.fullName),1),C("span",te,[C("span",null,D(De(e.email,25)),1)])])])),_:2},1024),k(U,null,{default:V((()=>[C("span",ne,D(De(e.consoleRole,25)),1)])),_:2},1024),k(U,null,{default:V((()=>[C("div",ie,[C("span",oe,[A(" Department : "),C("b",null,D(De(e.userDetailConsole?.department,25)),1)]),C("span",re,[A("Role in Dprmt : "),C("b",null,D(De(e.userDetailConsole?.departmentRole?e.userDetailConsole.departmentRole:"",20)),1)])])])),_:2},1024),k(U,{column:{align:"center"}},{default:V((()=>[k(z,null,{default:V((()=>[k(F,{color:"success",outlined:"",circle:"",icon:"lucide:pencil",onClick:l=>(async e=>{try{q.value=!0;const l=await L.find("/ConsoleUser/GetById",`?userid=${e}`);J.value=l,Y.value=!0,J.value?.roleList?.forEach((e=>{Pe(e)}))}catch(l){console.error("Error fetching user by ID :",l)}finally{q.value=!1}})(e.id)},{default:V((()=>[A(" Change permissions ")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])))),128))])),_:1})])),_:1},8,["data"])):R("",!0),!B.value&&M.value.totalItems>M.value.itemsPerPage?(y(),w(H,{key:2,"current-page":M.value.page,"onUpdate:currentPage":[v[1]||(v[1]=e=>M.value.page=e),je],"item-per-page":M.value.itemsPerPage,"total-items":M.value.totalItems,"max-links-displayed":5,"no-router":""},null,8,["current-page","item-per-page","total-items"])):R("",!0)])]),ue,k(Ie,{open:Y.value,size:"big",actions:"center",title:"Adding Roles to User",noclose:!0,loading:q.value,"cancel-label":"Cancel",onClose:v[3]||(v[3]=e=>Re())},{content:V((()=>[J.value?(y(),S("div",ce,[k(h,{initials:J.value.userDetailConsole?.fullName?J.value.userDetailConsole.fullName[0]+(J.value.userDetailConsole.fullName[1]||""):"",size:"large"},null,8,["initials"]),C("p",null,[C("strong",null,D(J.value.userDetailConsole?.fullName),1)]),C("p",null,[C("strong",null,D(J.value.email),1)]),C("p",null,D(J.value.userDetailConsole?.departmentRole),1),de,C("div",me,[C("div",pe,[ve,ge,C("div",_e,[(y(!0),S(j,null,b(T(O),((e,l)=>(y(),S("div",{key:l,class:"collapse-item"},[C("button",{class:"toggle-btn",onClick:e=>{return a=l,void(K.value=K.value===a?null:a);var a}},[A(D((K.value,`${l}`))+" ",1),K.value!==l?(y(),S("i",ye)):R("",!0),K.value===l?(y(),S("i",we)):R("",!0)],8,fe),k(I,{name:"slide"},{default:V((()=>[K.value===l?(y(),S("div",Ve,[k(Ne,null,{default:V((()=>[(y(!0),S(j,null,b(e,(e=>(y(),w(Ae,{key:e,rounded:"",class:"roleItem",color:"success",onClick:l=>Pe(e)},{default:V((()=>[A(D(e),1)])),_:2},1032,["onClick"])))),128))])),_:2},1024)])):R("",!0)])),_:2},1024)])))),128))])]),C("div",he,[C("h1",null,D(J.value.userDetailConsole?.fullName)+" Roles",1),Ce,k(Ne,null,{default:V((()=>[(y(!0),S(j,null,b(Q.value,(e=>(y(),w(Ae,{key:e,color:"success",rounded:"",class:"roleItem",onClick:l=>(async e=>{Q.value.includes(e)&&Q.value.splice(Q.value.indexOf(e),1)})(e)},{default:V((()=>[A(D(e),1)])),_:2},1032,["onClick"])))),128))])),_:1})])])])):(y(),S("div",ke,xe))])),action:V((()=>[k(F,{color:"primary",raised:"",loading:W.value,disabled:!Q.value.length,onClick:v[2]||(v[2]=e=>(async()=>{W.value=!0;try{if(J.value){const e=await L.updateRoles("/ConsoleUser/ManageRole?id="+J.value.id,Q.value);e?(G.success("User roles updated successfully!"),console.log("User roles updated successfully!"+e),Re()):(G.error("Failed to update user roles. API returned unsuccessful."),console.error("API call to update roles was unsuccessful:",e))}else G.warning("No user selected to update roles for."),console.warn("updateRoles called without a selected user.")}catch(e){G.error(`Error updating user roles: ${e.message||"Unknown error"}`),console.error("Error updating user roles:",e)}finally{W.value=!1}})())},{default:V((()=>[A(" Update role ")])),_:1},8,["loading","disabled"])])),_:1},8,["open","loading"])])])),_:1},8,["active"])}}});"function"==typeof W&&W(Pe);const Re=$(Pe,[["__scopeId","data-v-a40a8f01"]]);export{Re as default};
