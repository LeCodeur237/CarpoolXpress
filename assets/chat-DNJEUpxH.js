import{_ as s}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{t as e,v as a,M as i,e as t,r as l,x as n,m as d,Y as o,a4 as r,P as c,H as u,I as p,o as m,z as v,R as g,S as f,A as h,y,a1 as _,a2 as w}from"./index-D0hxrqC2.js";import{u as b}from"./useDropdown-BByI789t.js";import{u as k}from"./defaultResource-Cajrc19W.js";import{u as j}from"./viewWrapper-Bt2ctQXZ.js";import{d as I,e as C}from"./common-DaPMhcAK.js";import{b as x}from"./route-block-B_A1xBdJ.js";import"./useNotyf-NZFZ9G1y.js";import"./notyf-C-d_IrqK.js";import"./useFetch-Bhw7oTLc.js";import"./datetime-xmklhC0O.js";const S={class:"chat-body-wrap"};const U=s({},[["render",function(s,t){return e(),a("div",S,[i(s.$slots,"default")])}]]),D={id:"chat-body",class:"chat-body"};const M=s({},[["render",function(s,t){return e(),a("ol",D,[i(s.$slots,"default")])}]]),W={class:"message-field-wrapper"},F={class:"control"},H={class:"add-content"},O=[n("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:plus"},null,-1)],P=n("div",{class:"dropdown-menu",role:"menu"},[n("div",{class:"dropdown-content"},[n("a",{class:"dropdown-item"},[n("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:video"}),n("div",{class:"meta"},[n("span",null,"Video"),n("span",null,"Embed a video")])]),n("a",{href:"#",class:"dropdown-item kill-drop v-modal-trigger"},[n("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:image"}),n("div",{class:"meta"},[n("span",null,"Images"),n("span",null,"Upload pictures")])]),n("a",{href:"#",class:"dropdown-item kill-drop v-modal-trigger"},[n("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:link"}),n("div",{class:"meta"},[n("span",null,"Link"),n("span",null,"Post a link")])]),n("hr",{class:"dropdown-divider"}),n("a",{href:"#",class:"dropdown-item kill-drop v-modal-trigger"},[n("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:file"}),n("div",{class:"meta"},[n("span",null,"File"),n("span",null,"Upload a file")])])])],-1),$=n("div",{class:"add-emoji"},[n("div",{class:"button"},[n("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:smile"})])],-1),A=n("div",{class:"typing-indicator"},[n("img",{src:"/images/icons/misc/typing.gif",alt:""})],-1),K=t({__name:"ChatMessageFieldWrapper",emits:["send"],setup(s,{emit:i}){const t=l(),u=b(t),p=l(""),m=i,v=()=>{const s=p.value.trim();s&&(m("send",s),p.value="")};return(s,i)=>(e(),a("div",W,[n("div",F,[n("div",H,[n("div",{ref_key:"dropdownElement",ref:t,class:"dropdown dropdown-trigger is-up"},[n("div",null,[n("div",{class:"button","aria-haspopup":"true",onClick:i[0]||(i[0]=(...s)=>d(u).toggle&&d(u).toggle(...s))},O)]),P],512)]),$,o(n("input",{id:"chat-input",class:"input is-rounded",type:"text",placeholder:"Write a message ...","aria-label":"Write a message","onUpdate:modelValue":i[1]||(i[1]=s=>p.value=s),onKeyup:c(v,["enter"])},null,544),[[r,p.value]]),n("div",{class:"send-message"},[n("div",{class:"button v-button is-primary is-raised is-rounded",onClick:v}," Send ")])]),A]))}}),R={class:"is-chat animated preFadeInUp fadeInUp"},z=t({__name:"ChatCard",emits:["send"],setup(s,{emit:t}){const l=t;return(s,t)=>{const n=M,d=U;return e(),a("div",R,[u(d,null,{default:p((()=>[u(n,null,{default:p((()=>[i(s.$slots,"body")])),_:3}),i(s.$slots,"side")])),_:3}),u(K,{onSend:t[0]||(t[0]=s=>l("send",s))})])}}}),E=s=>(_("data-v-0ad97677"),s=s(),w(),s),G={class:"is-chat_container"},V={key:0,class:"no-messages"},q=[E((()=>n("img",{class:"light-image",src:"/assets/search-5-Uh5GWafy.svg",alt:""},null,-1))),E((()=>n("img",{class:"dark-image",src:"/assets/search-5-dark-Dj4jz-Pw.svg",alt:""},null,-1))),E((()=>n("div",{class:"text"},[n("h3",null,"Aucun message visible"),n("p",null," Sélectionner une conversation pour commencer à répondre aux besoins ")],-1)))],L={class:"is-message_list"},N=[E((()=>n("div",{class:"loader is-loading"},null,-1)))],T={class:"is-chat_side"},X=["onKeydown","onClick"],Y={class:"is-chat_sender"},B={class:"is-chat_sub"},J=t({__name:"chat",emits:["toggleMobileConversation"],setup(s,{emit:i}){const t=j(),o=k(),r=l([]),_=l(),w=l([]),b=l(),x=l(!1),S=async()=>{try{x.value=!0;const s=await o.list("/HelpDesk/GetAllMessages");if(s&&s.length>0){const e=s.reduce(((s,e)=>(s[e.clientId]=s[e.clientId]||[],s[e.clientId].push(e),s)),{});w.value=e,r.value=s}}catch(s){console.log("an error has occured: ",s)}finally{x.value=!1}},U=async s=>{b.value=s;const e=Object.values(w.value)[s];_.value=I(e)},D=async s=>{const e="00000000-0000-0000-0000-000000000000",a={id:e,clientId:_.value?.at(0)?.clientId??e,message:s,consoleUserId:"00000000-0000-0000-0000-000000000001",sendingDate:(new Date).toISOString(),isRead:!0};await o.add("HelpDesk/SendMessage",a)&&(await S(),_&&U(b.value??0))},M=s=>"00000000-0000-0000-0000-000000000000"===s.consoleUserId?"is-received":"is-sended";return m((async()=>{t.setPageTitle("Chat"),await S()})),(s,i)=>{const t=z;return e(),a("div",G,[u(t,{onSend:D},{body:p((()=>[d(_)?v("",!0):(e(),a("li",V,q)),n("div",L,[(e(!0),a(g,null,f(d(_),(s=>(e(),a("li",{key:s.id,class:h(["is-message_elt",M(s)])},y(s.message),3)))),128))]),n("li",{class:h(["chat-loader",[d(x)&&"is-active"]])},N,2)])),side:p((()=>[n("div",T,[(e(!0),a(g,null,f(Object.values(d(w)),((s,i)=>(e(),a("div",{key:i,class:h(["is-chat_elt",s.at(-1).clientId===d(_)?.at(0)?.clientId&&"active"]),tabindex:"0",role:"button",onKeydown:[c((s=>U(i)),["enter"]),c((s=>U(i)),["space"])],onClick:s=>U(i)},[n("h3",Y,y(s.at(-1).clientId),1),n("span",B,y(d(C)(s.at(-1).message,60)),1)],42,X)))),128))])])),_:1})])}}});"function"==typeof x&&x(J);const Q=s(J,[["__scopeId","data-v-0ad97677"]]);export{Q as default};
