import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-BltQe-xz.js";import{_ as s}from"./VAvatar.vue_vue_type_style_index_0_lang-Bxz39T17.js";import{_ as t}from"./VLoader.vue_vue_type_style_index_0_lang-C7-GgvIg.js";import{_ as l}from"./VFlexPagination.vue_vue_type_script_setup_true_lang-Cw9ZBBgT.js";import{_ as a}from"./VPlaceholderPage.vue_vue_type_style_index_0_lang-DK1cPkHB.js";import{_ as i}from"./VButton.vue_vue_type_style_index_0_lang-B-ef5zKO.js";import{e as r,r as n,Q as o,o as u,w as d,t as c,v as m,x as v,Y as p,a4 as y,m as h,j as f,R as _,S as g,H as b,I as w,A as P,y as x,L as D,J as k,a5 as C,z as S}from"./index-t9U-pc91.js";import{_ as T,a as j}from"./search-1-dark-DV4mRi9_.js";import{u as O}from"./viewWrapper-Yjs2_JvI.js";import{u as I}from"./defaultResource-C1sSR1bb.js";import{_ as N}from"./VTag.vue_vue_type_style_index_0_lang-CfiYdP3K.js";import{f as z,a as L,T as R,r as A,b as V}from"./common-DgfrY2qF.js";import{D as $}from"./datetime-xmklhC0O.js";import{Q as F}from"./main-0Gz-XdKX.js";import{b as J}from"./route-block-B_A1xBdJ.js";import"./VFlex.vue_vue_type_style_index_0_lang-C5rz8FA7.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";import"./useNotyf-CMZ2FBRq.js";import"./notyf-YfXYPISH.js";import"./useFetch-r6-7WS48.js";const M={class:"list-view-toolbar"},U={class:"search-widget",style:{width:"200px"}},E={class:"field"},B={class:"control"},Y=["disabled"],H=[v("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:search"},null,-1)],Q={class:"is-profile_tabs"},W=["onClick"],q={class:"date-picker"},G={class:"page-content-inner"},X=v("img",{class:"light-image",src:T,alt:""},null,-1),K=v("img",{class:"dark-image",src:j,alt:""},null,-1),Z={key:1,class:"is-list_view"},ee=v("div",{class:"is-list_header"},[v("div",{class:"is-list_header-item",style:{width:"15%"}}," Driver "),v("div",{class:"is-list_header-item",style:{width:"10%"}}," Itinerary "),v("div",{class:"is-list_header-item",style:{width:"10%"}}," DateTime "),v("div",{class:"is-list_header-item",style:{width:"5%"}}," Nbr "),v("div",{class:"is-list_header-item",style:{width:"10%"}}," Type "),v("div",{class:"is-list_header-item",style:{width:"10%"}}," Trip "),v("div",{class:"is-list_header-item",style:{width:"5%"}}," Canc "),v("div",{class:"is-list_header-item",style:{width:"5%"}}," Rfund "),v("div",{class:"is-list_header-item",style:{width:"5%"}}," PaySta "),v("div",{class:"is-list_header-item",style:{width:"12%","text-align":"center"}}," Profit "),v("div",{class:"is-list_header-item",style:{width:"10%"}}," Due Date ")],-1),se={class:"is-list_line-item is-user",style:{width:"15%"}},te={class:"is-user_metadata"},le={class:"has-text-primary is-underlined"},ae={class:"is-list_line-item",style:{width:"10%"}},ie={class:"is-list_line-item",style:{width:"10%"}},re={class:"is-list_line-item",style:{width:"5%"}},ne=["onClick"],oe={class:"is-list_line-item",style:{width:"10%"}},ue={style:{"font-size":"0.75rem"}},de={class:"is-list_line-item",style:{width:"10%"}},ce={style:{"font-size":"0.85rem"}},me={class:"is-list_line-item",style:{width:"5%"}},ve={style:{"font-size":"0.75rem"}},pe={class:"is-list_line-item",style:{width:"5%"}},ye=v("small",{style:{"font-size":"0.75rem"}},"soon",-1),he={class:"is-list_line-item",style:{width:"5%"}},fe=v("small",{style:{"font-size":"0.75rem"}},"soon",-1),_e={class:"is-list_line-item",style:{width:"12%","text-align":"center"}},ge={style:{"font-size":"0.85rem","text-align":"center"},class:"ml-2"},be={class:"is-list_line-item",style:{width:"10%"}},we={key:0},Pe={class:"card-list-item"},xe={class:"info"},De={class:"somme"},ke={class:"amounts"},Ce={class:"amount"},Se={class:"d-flex"},Te=v("b",{class:"label"},"Number of seats :",-1),je={class:"money"},Oe=v("b",{class:"label"},"Trip :",-1),Ie={class:"money"},Ne=v("b",{class:"label"},"Booking fees :",-1),ze={key:0,class:"money"},Le=v("b",{class:"label"},"taxes :",-1),Re={class:"money"},Ae={class:"amount"},Ve={class:"d-flex"},$e=v("b",{class:"label"},"Onbudged :",-1),Fe={key:0,class:"bull"},Je={key:1,class:"bull"},Me=v("p",null,[v("b",{class:"label"},"Coupon :"),v("b",{class:"money"}," - ")],-1),Ue={class:"total"},Ee=v("b",{class:"label"},"Paid :",-1),Be={key:0,class:"money"},Ye={key:0,class:"total"},He=v("b",{class:"label"},"Refund :",-1),Qe={key:0,class:"moneyrefund"},We={key:1,class:"moneyrefund"},qe={key:2,class:"moneyrefund"},Ge={key:1,class:"total"},Xe=v("b",{class:"label"},"Refund :",-1),Ke={key:0,class:"moneyrefund"},Ze={class:"total"},es=v("b",{class:"label"},"Canceled :",-1),ss={key:0,class:"bull"},ts={key:1,class:"bull"},ls=v("br",null,null,-1),as={key:0,class:"is-pc_body"},is={class:"travel"},rs=v("span",null,"Depart",-1),ns=v("i",{class:"iconify has-text-primary","aria-hidden":"true","data-icon":"solar:map-point-bold-duotone"},null,-1),os=v("span",null,"ArrivÃ©e",-1),us=v("i",{class:"iconify has-text-success","aria-hidden":"true","data-icon":"solar:map-point-bold-duotone"},null,-1),ds=v("div",{class:"is-dest_elt_divider"},null,-1),cs={key:1},ms=[v("p",{class:"has-text-centered"}," No passengers found for this trip. ",-1)],vs=r({__name:"index",setup(r){const T=O(),j=I(),J=["All","Pending","Completed"],vs=n(""),ps=n(!1),ys=n({currentPage:1,perPage:9,total:0}),hs=n("All"),fs=n([]),_s=n(!1),gs=n([]),bs=n([new Date("2025-04-01"),new Date("2025-12-31")]),ws=n(null),Ps=n([]),xs=n(!1),Ds=e=>{const s=$.fromISO(e).plus({hours:6});return $.now()>s},ks=e=>{ys.value.currentPage=e},Cs=o((()=>{let e=fs.value.filter((e=>e.user));if(e=e.filter((e=>"All"===hs.value?"00000000-0000-0000-0000-000000000000"==e.parentId&&null==e.listOfReservations.childDriverJourneyId:"Pending"===hs.value?"1"===e.status&&!Ds(e.travelingDate):"Completed"!==hs.value||("2"===e.status||Ds(e.travelingDate)))),bs.value&&bs.value[0]&&bs.value[1]){const s=$.fromJSDate(bs.value[0]).startOf("day"),t=$.fromJSDate(bs.value[1]).endOf("day");e=e.filter((e=>{const l=$.fromISO(e.travelingDate);return l>=s&&l<=t}))}if(vs.value&&vs.value.trim().length>0){const s=vs.value.trim().toLowerCase();e=e.filter((e=>e.user?.userDetail?.firstName?.toLowerCase().includes(s)||e.user?.userDetail?.lastName?.toLowerCase().includes(s)||e.user?.email?.toLowerCase().includes(s)||e.departurePoint?.city?.toLowerCase().includes(s)||e.departurePoint?.address?.toLowerCase().includes(s)||e.destinationPoint?.city?.toLowerCase().includes(s)||e.destinationPoint?.address?.toLowerCase().includes(s)))}ys.value.total=e.length;const s=(ys.value.currentPage-1)*ys.value.perPage,t=s+ys.value.perPage;return e.slice(s,t)})),Ss=()=>{_s.value=!1,Ps.value=[],ws.value=null,xs.value=!1,gs.value=[]},Ts=e=>{let s=0;return e&&e.listOfReservations&&e.listOfReservations.forEach((e=>{if("1"===e.isCanceled){const t=(e.amountPerSeat-1.695-.0396*e.amountPerSeat)*e.numberOfSeat;s+=t}})),z(s)},js=async()=>{ps.value=!0;try{const e=await j.list("/DriverJourney/GetAllJourney");if(!e||!Array.isArray(e))return fs.value=[],void(ys.value.total=0);const s=[...new Set(e.map((e=>e.userId)).filter((e=>null!=e)))].map((e=>Os(e))),t=await Promise.all(s),l=new Map;t.forEach((e=>{e&&e.id&&l.set(e.id,e)}));const a=e.map((e=>{const s=l.get(e.userId);return{...e,user:s||null}}));fs.value=a,ys.value.total=a.length}catch(e){console.error("An error has occurred: ",e)}finally{ps.value=!1}},Os=async e=>{try{return await j.listUser(`/User/FindUserById?userid=${e}`)}catch(s){return console.error(`Error fetching user ${e}: `,s),null}};return u((async()=>{T.setPageTitle("List of Journeys"),await js()})),d([bs,hs,vs],(()=>{ys.value.currentPage=1})),(r,n)=>{const o=i,u=a,d=l,T=t,O=s,I=e;return c(),m("div",null,[v("div",M,[v("div",U,[v("div",E,[v("div",B,[p(v("input",{"onUpdate:modelValue":n[0]||(n[0]=e=>f(vs)?vs.value=e:null),type:"text",class:"input",placeholder:"Rechercher..."},null,512),[[y,h(vs)]]),v("button",{class:"search-button",disabled:h(vs).length<1},H,8,Y)])])]),v("ul",Q,[(c(),m(_,null,g(J,((e,s)=>v("li",{key:s,class:P([e===h(hs)&&"is-active_tab","is-p_tab"]),onClick:s=>hs.value=e},x(e),11,W))),64))]),v("div",q,[b(h(F),{modelValue:h(bs),"onUpdate:modelValue":n[1]||(n[1]=e=>f(bs)?bs.value=e:null),"model-auto":"",range:"","time-picker":!1,class:"date-picker-value",locale:"en"},null,8,["modelValue"])]),b(o,{icon:"lucide:refresh-cw",color:"danger",onClick:js},{default:w((()=>[D(" Refresh ")])),_:1})]),b(T,{active:h(ps)},{default:w((()=>[v("div",G,[0===h(Cs).length?(c(),k(u,{key:0,title:"We couldn't find any matching results.",subtitle:"Too bad. Looks like we couldn't find any matching results for the\r\n              filter terms you've entered. Please try different filter terms or\r\n              criteria.",larger:""},{image:w((()=>[X,K])),_:1})):(c(),m("div",Z,[ee,(c(!0),m(_,null,g(h(Cs),(e=>{return c(),m("div",{key:e.id,class:"is-list_line"},[v("div",se,[v("div",te,[v("h3",null,x(`${e.user?.userDetail?.lastName} ${e.user?.userDetail?.firstName}`),1),v("p",null,x((s=e.user?.email,t=18,s?s.length>t?s.slice(0,t)+"...":s:"")),1),v("p",le,x(e.user?.phoneNumber),1)])]),v("div",ae,[v("p",null,"from "+x(e?.departurePoint?.city??"City"),1),v("p",null,"to "+x(e?.destinationPoint?.city??"City"),1)]),v("div",ie,[v("p",null,x(h($).fromISO(e.travelingDate).toFormat("dd/MM/yy")),1),v("p",null,[v("small",null,[v("b",null,x(h($).fromISO(e.travelingDate).toFormat("hh:mm a")),1)])])]),v("div",re,[v("span",{style:C(e.maxSeats-e.avalableSeets>0?"cursor: pointer;":"cursor: default;"),onClick:s=>e.maxSeats-e.avalableSeets>0?(async e=>{if(_s.value=!0,ws.value===e.id)ws.value=null,Ps.value=[];else if(ws.value=e.id,Ps.value=[],xs.value=!0,e&&e.listOfReservations&&e.listOfReservations.length>0)try{const s=e.listOfReservations.map((async e=>{if(e.userId)try{const s=await j.list(`/User/FindUserById?userid=${e.userId}`);if(s){const t=e.childDriverJourneyId?fs.value.find((s=>s.id===e.childDriverJourneyId)):null;return{user:s,reservation:e,childTrip:t}}}catch(s){return console.error(`Error fetching user ${e.userId} for reservation ${e.id}:`,s),[]}return[]})),t=(await Promise.all(s)).filter((e=>null!==e));Ps.value=t,xs.value=!1}catch(s){console.error(`Error fetching passenger details for trip ${e.id}:`,s),Ps.value=[]}finally{xs.value=!1}else Ps.value=[],xs.value=!1})(e):null},x(e.maxSeats-e.avalableSeets),13,ne)]),v("div",oe,[b(N,{size:"tiny",style:{width:"fit-content","line-height":"1.6",display:"flex"},color:e.isPaiementCash?"success":"info"},{default:w((()=>[v("small",ue,x(e.isPaiementCash?"cash":"in-app"),1)])),_:2},1032,["color"])]),v("div",de,[v("b",ce,x(h(z)(e.amountPerSeet)),1)]),v("div",me,[b(N,{size:"tiny",style:{width:"fit-content","line-height":"1.6",display:"flex"},color:"1"===e.status?"success":"warning"},{default:w((()=>[v("small",ve,x("1"===e.status?"No":"Yes"),1)])),_:2},1032,["color"])]),v("div",pe,[b(N,{size:"tiny",style:{width:"fit-content","line-height":"1.6",display:"flex"},color:"warning"},{default:w((()=>[ye])),_:1})]),v("div",he,[b(N,{size:"tiny",style:{width:"fit-content","line-height":"1.6",display:"flex"},color:"warning"},{default:w((()=>[fe])),_:1})]),v("div",_e,[b(N,{color:Ts(e).length>1?"success":"danger",size:"tiny"},{default:w((()=>[v("b",ge,x(Ts(e)),1)])),_:2},1032,["color"])]),v("div",be,[v("p",null,[v("b",null,x(h($).fromISO(e.travelingDate).plus({days:5}).toFormat("dd/MM/yy")),1)])])]);var s,t})),128))])),b(d,{"current-page":h(ys).currentPage,"onUpdate:currentPage":[n[2]||(n[2]=e=>h(ys).currentPage=e),ks],"item-per-page":h(ys).perPage,"total-items":h(ys).total,"max-links-displayed":7,"no-router":""},null,8,["current-page","item-per-page","total-items"])])])),_:1},8,["active"]),b(I,{open:h(_s),actions:"center",title:"List of Passengers",noclose:"",noaction:"",size:"medium",noscroll:!1,onClose:Ss},{content:w((()=>[b(T,{active:1==h(xs),text:h(xs)?"Loading passengers...":"",translucent:!0},{default:w((()=>[h(Ps)&&h(Ps).length>0?(c(),m("div",we,[(c(!0),m(_,null,g(h(Ps),(e=>(c(),m("ul",{key:e.user.id,class:"card"},[v("li",Pe,[v("div",xe,[b(O,{initials:`${e.user.userDetail?.lastName?.[0]||""}${e.user.userDetail?.firstName?.[0]||""}`.trim()||"NA",picture:e.user.profilePhoto?.photo?`data:image/jpeg;base64,${e.user.profilePhoto.photo}`:void 0,size:"xl",squared:"",to:`/app/carpoolers/${e.user.id}`},null,8,["initials","picture","to"]),v("span",null,x(e.user.userDetail?.firstName+" "+e.user.userDetail?.lastName),1),v("span",null,x(e.user.email),1)]),v("div",De,[v("div",ke,[v("div",Ce,[v("div",Se,[v("p",null,[Te,v("b",je," 0"+x(e.reservation.numberOfSeat??0),1)]),v("p",null,[Oe,v("b",Ie,x(h(z)(e.reservation.amountPerSeat??0)),1)]),v("p",null,[Ne,e.childTrip?(c(),m("b",ze,x(h(L)(e.childTrip.amountPerSeet??0,.175)),1)):S("",!0)]),v("p",null,[Le,v("b",Re,x(h(L)(e.reservation.amountPerSeat??0,.13)),1)])])]),v("div",Ae,[v("div",Ve,[v("p",null,[$e,e.childTrip.amountPerSeet!==e.reservation.amountPerSeat?(c(),m("b",Fe," Yes ")):(c(),m("b",Je," No "))]),Me])])]),v("p",Ue,[Ee,e.childTrip?(c(),m("b",Be,x(h(R)(e.childTrip.amountPerSeet??0,e.reservation.numberOfSeat)),1)):S("",!0)]),!1===e.childTrip.isPaiementCash?(c(),m("p",Ye,[He,"paid"===h(A)(e.childTrip.travelingDate,e.childTrip.creationDate)&&"0"===e.reservation.isCanceled?(c(),m("b",Qe," -"+x(h(R)(e.childTrip.amountPerSeet??0,e.reservation.numberOfSeat)),1)):S("",!0),"refunded"===h(A)(e.childTrip.travelingDate,e.childTrip.creationDate)&&"0"===e.reservation.isCanceled?(c(),m("b",We," -"+x(h(z)(e.reservation.totalAmount/2)),1)):S("",!0),"no refund"===h(A)(e.childTrip.travelingDate,e.childTrip.creationDate)&&"0"===e.reservation.isCanceled?(c(),m("b",qe," 0 ")):S("",!0)])):S("",!0),!0===e.childTrip.isPaiementCash&&"0"===e.reservation.isCanceled?(c(),m("p",Ge,[Xe,"paid"===h(A)(e.childTrip.travelingDate,e.childTrip.creationDate)?(c(),m("b",Ke,x(h(V)(e.childTrip.amountPerSeet??0,e.reservation.numberOfSeat)),1)):S("",!0)])):S("",!0),v("p",Ze,[es,"1"===e.reservation.isCanceled?(c(),m("b",ss," No ")):(c(),m("b",ts,[D(" Yes"),ls,D(" "+x(h($).fromISO(e.childTrip.travelingDate).toFormat("dd/MM/yy hh:mm a")),1)]))])])]),e.childTrip?(c(),m("li",as,[v("div",is,[v("h4",null,[rs,ns,D(" "+x(e.childTrip.departurePoint.city??"City"),1)]),v("h4",null,[os,us,D(" "+x(e.childTrip.destinationPoint.city??"City"),1)])]),ds])):S("",!0)])))),128))])):S("",!0),h(Ps)&&0===h(Ps).length&&0==h(xs)?(c(),m("div",cs,ms)):S("",!0)])),_:1},8,["active","text"])])),_:1},8,["open"])])}}});"function"==typeof J&&J(vs);export{vs as default};
