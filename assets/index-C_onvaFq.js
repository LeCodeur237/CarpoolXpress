import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-BltQe-xz.js";import{_ as s}from"./VLoader.vue_vue_type_style_index_0_lang-C7-GgvIg.js";import{_ as i}from"./VFlexPagination.vue_vue_type_script_setup_true_lang-Cw9ZBBgT.js";import{e as t,t as a,v as l,y as r,A as n,r as o,Q as u,w as d,o as c,G as m,x as v,m as p,R as f,S as y,H as h,j as _,I as g,J as P,z as b,a6 as w,L as D,a8 as k}from"./index-t9U-pc91.js";import{_ as N}from"./VIconButton-CtCxSKsr.js";import{_ as C}from"./VAvatar.vue_vue_type_style_index_0_lang-Bxz39T17.js";import{_ as x}from"./VPlaceholderPage.vue_vue_type_style_index_0_lang-DK1cPkHB.js";import{_ as $}from"./VButton.vue_vue_type_style_index_0_lang-B-ef5zKO.js";import{_ as j,a as A}from"./search-1-dark-DV4mRi9_.js";import{u as O}from"./viewWrapper-Yjs2_JvI.js";import{u as S}from"./defaultResource-C1sSR1bb.js";import{_ as V}from"./VTag.vue_vue_type_style_index_0_lang-CfiYdP3K.js";import{f as z,c as R}from"./common-DgfrY2qF.js";import{D as L}from"./datetime-xmklhC0O.js";import{Q as I}from"./main-0Gz-XdKX.js";import{b as U}from"./route-block-B_A1xBdJ.js";import"./VFlex.vue_vue_type_style_index_0_lang-C5rz8FA7.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";import"./useNotyf-CMZ2FBRq.js";import"./notyf-YfXYPISH.js";import"./useFetch-r6-7WS48.js";const T=["value","max"],F=t({__name:"VProgress",props:{value:{default:void 0},max:{default:100},size:{default:void 0},color:{default:"primary"}},setup(e){const s=e;return(e,i)=>(a(),l("progress",{class:n(["progress",[s.size&&`is-${s.size}`,s.color&&`is-${s.color}`]]),value:s.value,max:s.max},r(s.value?s.value/s.max*100+"%":""),11,T))}}),J={class:"list-view-toolbar"},q={class:"is-viewmode_toggler"},B=[v("i",{class:"iconify","aria-hidden":"true","data-icon":"material-symbols-light:event-list-outline-rounded"},null,-1)],M=[v("i",{class:"iconify","aria-hidden":"true","data-icon":"material-symbols-light:grid-view-outline"},null,-1)],E={class:"is-profile_tabs"},G=["onClick"],H={class:"date-picker"},Q={class:"buttons"},W={class:"page-content-inner"},X=v("img",{class:"light-image",src:j,alt:""},null,-1),K=v("img",{class:"dark-image",src:A,alt:""},null,-1),Y={key:0,class:"is-trips_container is-grid grid-cols-3 gap-4"},Z={class:"is-tc_head"},ee={class:"is-tch_meta"},se={class:"has-text-primary is-underlined"},ie={class:"is-tc_body"},te={class:"is-dest_elt"},ae=v("i",{class:"iconify has-text-primary","aria-hidden":"true","data-icon":"solar:map-point-bold-duotone"},null,-1),le={class:"is-dest_details"},re={class:"is-dest_elt"},ne=v("i",{class:"iconify has-text-success","aria-hidden":"true","data-icon":"solar:map-point-bold-duotone"},null,-1),oe={class:"is-dest_details"},ue=v("div",{class:"is-dest_elt_divider"},null,-1),de={class:"is-tc_footer"},ce={class:"is-tcf_l"},me=v("i",{class:"iconify","data-icon":"solar:chair-2-line-duotone","aria-hidden":"true"},null,-1),ve={class:"is-tcf_r"},pe=v("small",null,"Profit",-1),fe={style:{"font-size":"0.95rem"},class:"ml-2"},ye={key:0,class:"passengers"},he={key:0,class:"passenger-list-container"},_e={key:1,class:"passenger-avatars"},ge={class:"info"},Pe={class:"details"},be={class:"amount"},we={class:"money"},De={class:"money"},ke={class:"money"},Ne={key:2,class:"has-text-centered is-size-7 py-2"},Ce={key:1,class:"is-list_view"},xe=v("div",{class:"is-list_header"},[v("div",{class:"is-list_header-item",style:{width:"25%"}}," # "),v("div",{class:"is-list_header-item",style:{width:"15%"}}," From "),v("div",{class:"is-list_header-item",style:{width:"15%"}}," To "),v("div",{class:"is-list_header-item",style:{width:"15%"}}," Traveling Date "),v("div",{class:"is-list_header-item",style:{width:"10%"}}," Seats "),v("div",{class:"is-list_header-item",style:{width:"10%"}}," PU "),v("div",{class:"is-list_header-item",style:{width:"10%"}}," Profit ")],-1),$e={class:"is-list_line-item is-user",style:{width:"25%"}},je=["onClick"],Ae={class:"is-user_metadata"},Oe={class:"has-text-primary is-underlined"},Se={class:"is-list_line-item",style:{width:"15%"}},Ve={class:"is-list_line-item",style:{width:"15%"}},ze={class:"is-list_line-item",style:{width:"15%"}},Re={class:"is-list_line-item",style:{width:"10%"}},Le={class:"is-list_line-item",style:{width:"10%"}},Ie={style:{"font-size":"0.95rem"},class:"ml-2"},Ue={class:"is-list_line-item",style:{width:"10%"}},Te={style:{"font-size":"0.95rem"},class:"ml-2"},Fe={class:"is-trip_elt"},Je={class:"is-tc_head"},qe={class:"is-tch_meta"},Be={class:"has-text-primary is-underlined"},Me={class:"is-tc_body"},Ee={class:"is-dest_elt"},Ge=v("i",{class:"iconify has-text-primary","aria-hidden":"true","data-icon":"solar:map-point-bold-duotone"},null,-1),He={class:"is-dest_details"},Qe={class:"is-dest_elt"},We=v("i",{class:"iconify has-text-success","aria-hidden":"true","data-icon":"solar:map-point-bold-duotone"},null,-1),Xe={class:"is-dest_details"},Ke=v("div",{class:"is-dest_elt_divider"},null,-1),Ye={class:"is-tc_footer"},Ze={class:"is-tcf_l"},es=v("i",{class:"iconify","data-icon":"solar:chair-2-line-duotone","aria-hidden":"true"},null,-1),ss={class:"is-tcf_r"},is=v("small",null,"Profit",-1),ts={style:{"font-size":"0.95rem"},class:"ml-2"},as={key:0,class:"passengers"},ls={key:0,class:"passenger-list-container"},rs={key:1,class:"passenger-avatars"},ns={class:"info"},os={class:"details"},us={class:"amount"},ds={class:"money"},cs={class:"money"},ms={class:"money"},vs={key:2,class:"has-text-centered is-size-7 py-2"},ps=t({__name:"index",setup(t){const j=O(),A=S(),U=["All","Pending","Completed","Canceled"],T=o(""),ps=o(!1),fs=o(!1),ys=o("list"),hs=o({currentPage:1,perPage:9,total:0}),_s=o("All"),gs=o(),Ps=o([]),bs=o([new Date,new Date]),ws=o(null),Ds=o([]),ks=o(!1),Ns=e=>{const s=L.fromISO(e).plus({hours:6});return L.now()>s},Cs=e=>{hs.value.currentPage=e},xs=async e=>{if(ws.value===e.id)ws.value=null,Ds.value=[];else if(ws.value=e.id,Ds.value=[],ks.value=!0,e&&e.listOfReservations&&e.listOfReservations.length>0)try{const s=e.listOfReservations.map((async e=>{if(e.userId){const s=await A.list(`/User/FindUserById?userid=${e.userId}`);if(s)return{user:s,reservation:e}}return null})),i=(await Promise.all(s)).filter((e=>null!==e));Ds.value=i,ks.value=!1}catch(s){console.error(`Error fetching passenger details for trip ${e.id}:`,s),Ds.value=[]}finally{ks.value=!1}else Ds.value=[],ks.value=!1},$s=u((()=>{let e=Ps.value.filter((e=>e.user));if(e=e.filter((e=>"All"===_s.value||("Pending"===_s.value?"1"===e.status&&!Ns(e.travelingDate):"Completed"===_s.value?"2"===e.status||Ns(e.travelingDate):"Canceled"===_s.value?"0"===e.status:void 0))),bs.value&&bs.value[0]&&bs.value[1]){const s=L.fromJSDate(bs.value[0]).startOf("day"),i=L.fromJSDate(bs.value[1]).endOf("day");e=e.filter((e=>{const t=L.fromISO(e.travelingDate);return t>=s&&t<=i}))}if(T.value&&T.value.trim().length>0){const s=T.value.trim().toLowerCase();e=e.filter((e=>e.user?.userDetail?.firstName?.toLowerCase().includes(s)||e.user?.userDetail?.lastName?.toLowerCase().includes(s)||e.user?.email?.toLowerCase().includes(s)||e.departurePoint?.city?.toLowerCase().includes(s)||e.departurePoint?.address?.toLowerCase().includes(s)||e.destinationPoint?.city?.toLowerCase().includes(s)||e.destinationPoint?.address?.toLowerCase().includes(s)))}hs.value.total=e.length;const s=(hs.value.currentPage-1)*hs.value.perPage,i=s+hs.value.perPage;return e.slice(s,i)})),js=async()=>{try{ps.value=!0;const e=await A.list("/DriverJourney/GetAllJourney");if(!e||!Array.isArray(e))return Ps.value=[],void(hs.value.total=0);const s=[...new Set(e.map((e=>e.userId)).filter((e=>null!=e)))].map((e=>As(e))),i=await Promise.all(s),t=new Map;i.forEach((e=>{e&&e.id&&t.set(e.id,e)}));const a=e.map((e=>{const s=t.get(e.userId);return{...e,user:s||null}}));Ps.value=a,hs.value.total=a.length}catch(e){console.error("An error has occurred: ",e)}finally{ps.value=!1}},As=async e=>{try{return await A.listUser(`/User/FindUserById?userid=${e}`)}catch(s){return console.error(`Error fetching user ${e}: `,s),null}},Os=k((async()=>{hs.value.currentPage=1,await js()}),500);return d(T,(()=>{Os()})),d(_s,(()=>{hs.value.currentPage=1,Os()})),c((async()=>{j.setPageTitle("List of Journeys"),await js()})),(t,o)=>{const u=$,d=x,c=C,k=N,j=F,A=m("Tippy"),O=i,S=s,T=e;return a(),l("div",null,[v("div",J,[v("div",q,[v("span",{class:n(["is-viewmode","list"===p(ys)&&"is-active"]),onClick:o[0]||(o[0]=e=>ys.value="list")},B,2),v("span",{class:n(["is-viewmode","grid"===p(ys)&&"is-active"]),onClick:o[1]||(o[1]=e=>ys.value="grid")},M,2)]),v("ul",E,[(a(),l(f,null,y(U,((e,s)=>v("li",{key:s,class:n([e===p(_s)&&"is-active_tab","is-p_tab"]),onClick:s=>_s.value=e},r(e),11,G))),64))]),v("div",H,[h(p(I),{modelValue:p(bs),"onUpdate:modelValue":o[2]||(o[2]=e=>_(bs)?bs.value=e:null),"model-auto":"",range:"","time-picker":!1,class:"date-picker-value",locale:"en"},null,8,["modelValue"])]),v("div",Q,[h(u,{color:"primary",icon:"feather:refresh-ccw",elevated:"",rounded:""},{default:g((()=>[D(" Refresh ")])),_:1})])]),h(S,{active:p(ps)},{default:g((()=>[v("div",W,[0===p($s).length?(a(),P(d,{key:0,title:"We couldn't find any matching results.",subtitle:"Too bad. Looks like we couldn't find any matching results for the\r\n              filter terms you've entered. Please try different filter terms or\r\n              criteria.",larger:""},{image:g((()=>[X,K])),_:1})):(a(),l(f,{key:1},["grid"===p(ys)?(a(),l("div",Y,[(a(!0),l(f,null,y(p($s),(e=>(a(),l("div",{key:e.id,class:"is-trip_elt"},[v("div",Z,[h(c,{squared:"",size:"big",picture:`data:image/jpeg;base64,${e.user?.profilePhoto?.photo}`,initials:`${e.user?.userDetail?.lastName[0]}${e.user?.userDetail?.firstName[0]}`},null,8,["picture","initials"]),v("div",ee,[v("h3",null,r(`${e.user?.userDetail?.lastName} ${e.user?.userDetail?.firstName}`),1),v("span",null,r(e.user?.email),1),v("span",se,r(e.user?.phoneNumber),1),h(V,{size:"tiny",color:e.user?.isCodeVerified?"success":"danger",style:{width:"fit-content","line-height":"1.6"}},{default:g((()=>[D(r(e.user?.isCodeVerified?"Verified":"Not Verified"),1)])),_:2},1032,["color"])])]),v("div",ie,[v("div",te,[ae,v("div",le,[v("h4",null,r(e?.departurePoint?.city??"City"),1),v("span",null,r(e?.departurePoint?.address??"Address"),1)])]),v("div",re,[ne,v("div",oe,[v("h4",null,r(e?.destinationPoint?.city??"City"),1),v("span",null,r(e?.destinationPoint?.address??"Address"),1)])]),ue]),v("div",de,[v("div",ce,[me,v("span",null,r(e.avalableSeets)+" available seat(s)",1)]),v("div",ve,[h(V,{style:{width:"fit-content","line-height":"1.6",display:"flex"},color:"primary"},{default:g((()=>[pe,v("b",fe,r(e.listOfReservations?p(z)(e.listOfReservations?.filter((e=>"1"==e.isCanceled)).reduce(((e,s)=>e+s.totalAmount),0)):p(z)(0)),1)])),_:2},1024),v("span",null,r(p(R)(e.travelingDate)),1)])]),e.maxSeats-e.avalableSeets>0||e.listOfReservations&&e.listOfReservations.length>0?(a(),l("div",ye,[v("h1",null,[D(" Passengers "),h(k,{icon:p(ws)===e.id?"lucide:chevron-up":"lucide:chevron-down",circle:"",small:"",onClick:s=>xs(e)},null,8,["icon","onClick"])]),p(ws)===e.id?(a(),l("div",he,[p(ks)?(a(),P(j,{key:0,size:"tiny",indeterminate:"",class:"my-2"})):p(Ds).length>0?(a(),l("ul",_e,[v("li",null,[(a(!0),l(f,null,y(p(Ds),(e=>(a(),P(A,{key:e.user.id},{content:g((()=>[v("div",ge,[v("div",Pe,[v("p",null,r(e.user.userDetail?.firstName+" "+e.user.userDetail?.lastName),1),v("p",null,r(e.user.email),1),v("p",null,r(e.user.phoneNumber),1)]),v("div",be,[v("p",null,[D(" Amount : "),v("b",we,r(p(z)(e.reservation.amountPerSeat??0)),1)]),v("p",null,[D(" Seat : "),v("b",De," 0"+r(e.reservation.numberOfSeat??0),1)]),v("p",null,[D(" Total : "),v("b",ke,r(p(z)(e.reservation.totalAmount??0)),1)])])])])),default:g((()=>[h(c,{squared:"",size:"medium",class:"is-passenger mr-1","v-tooltip":`${e.user.userDetail?.lastName} ${e.user.userDetail?.firstName}`,initials:`${e.user.userDetail?.lastName?.[0]||""}${e.user.userDetail?.firstName?.[0]||""}`.trim()||"NA",picture:e.user.profilePhoto?.photo?`data:image/jpeg;base64,${e.user.profilePhoto.photo}`:void 0},null,8,["v-tooltip","initials","picture"])])),_:2},1024)))),128))])])):p(ks)||0!==p(Ds).length?b("",!0):(a(),l("p",Ne," No passengers found for this trip. "))])):b("",!0)])):b("",!0)])))),128))])):(a(),l("div",Ce,[xe,(a(!0),l(f,null,y(p($s),(e=>(a(),l("div",{key:e.id,class:"is-list_line"},[v("div",$e,[v("div",{onClick:()=>{gs.value=e,fs.value=!0}},[h(c,{squared:"",size:"medium",picture:`data:image/jpeg;base64,${e.user?.profilePhoto?.photo}`,initials:`${e.user?.userDetail?.lastName[0]}${e.user?.userDetail?.firstName[0]}`},null,8,["picture","initials"])],8,je),v("div",Ae,[v("h3",null,r(`${e.user?.userDetail?.lastName} ${e.user?.userDetail?.firstName}`),1),v("p",null,r(e.user?.email),1),v("p",Oe,r(e.user?.phoneNumber),1)])]),v("div",Se,[v("p",null,r(e?.departurePoint?.city??"City"),1),v("span",null,r(e?.departurePoint?.address??"Address"),1)]),v("div",Ve,[v("p",null,r(e?.destinationPoint?.city??"City"),1),v("span",null,r(e?.destinationPoint?.address??"Address"),1)]),v("div",ze,[v("span",null,r(p(L).fromISO(e.travelingDate).toFormat("dd/MM/yy, hh:mm a")),1)]),v("div",Re,[v("p",null,r(e.listOfReservations?.length??0)+" / "+r(e.avalableSeets),1)]),v("div",Le,[v("b",Ie,r(p(z)(e.amountPerSeet)),1)]),v("div",Ue,[h(V,{style:{width:"fit-content","line-height":"1.6",display:"flex"},color:"success"},{default:g((()=>[v("b",Te,r(e.listOfReservations?p(z)(e.listOfReservations?.filter((e=>"1"==e.isCanceled)).reduce(((e,s)=>e+s.totalAmount),0)):p(z)(0)),1)])),_:2},1024)])])))),128))])),h(O,{"current-page":p(hs).currentPage,"onUpdate:currentPage":[o[3]||(o[3]=e=>p(hs).currentPage=e),Cs],"item-per-page":p(hs).perPage,"total-items":p(hs).total,"max-links-displayed":7,"no-router":""},null,8,["current-page","item-per-page","total-items"])],64))])])),_:1},8,["active"]),(a(),P(w,{to:"body"},[p(fs)?(a(),P(T,{key:0,open:p(fs),"onUpdate:open":o[6]||(o[6]=e=>_(fs)?fs.value=e:null),title:"User Details",size:"large",nobg:"",noaction:"",noheader:"",onClose:o[7]||(o[7]=()=>fs.value=!1)},{content:g((()=>[v("div",Fe,[v("div",Je,[h(c,{squared:"",size:"big",picture:`data:image/jpeg;base64,${p(gs).user?.profilePhoto?.photo}`,initials:`${p(gs).user?.userDetail?.lastName[0]}${p(gs).user?.userDetail?.firstName[0]}`},null,8,["picture","initials"]),v("div",qe,[v("h3",null,r(`${p(gs).user?.userDetail?.lastName} ${p(gs).user?.userDetail?.firstName}`),1),v("span",null,r(p(gs).user?.email),1),v("span",Be,r(p(gs).user?.phoneNumber),1),h(k,{icon:"feather:x",circle:"",class:"modal-close-button",onClick:o[4]||(o[4]=e=>fs.value=!1)}),h(V,{size:"tiny",color:p(gs).user?.isCodeVerified?"success":"danger",style:{width:"fit-content","line-height":"1.6"}},{default:g((()=>[D(r(p(gs).user?.isCodeVerified?"Verified":"Not Verified"),1)])),_:1},8,["color"])])]),v("div",Me,[v("div",Ee,[Ge,v("div",He,[v("h4",null,r(p(gs)?.departurePoint?.city??"City"),1),v("span",null,r(p(gs)?.departurePoint?.address??"Address"),1)])]),v("div",Qe,[We,v("div",Xe,[v("h4",null,r(p(gs)?.destinationPoint?.city??"City"),1),v("span",null,r(p(gs)?.destinationPoint?.address??"Address"),1)])]),Ke]),v("div",Ye,[v("div",Ze,[es,v("span",null,r(p(gs).avalableSeets)+" available seat(s)",1)]),v("div",ss,[h(V,{style:{width:"fit-content","line-height":"1.6",display:"flex"},color:"primary"},{default:g((()=>[is,v("b",ts,r(p(gs).listOfReservations?p(z)(p(gs).listOfReservations?.filter((e=>"1"==e.isCanceled)).reduce(((e,s)=>e+s.totalAmount),0)):p(z)(0)),1)])),_:1}),v("span",null,r(p(R)(p(gs).travelingDate)),1)])]),p(gs).maxSeats-p(gs).avalableSeets>0||p(gs).listOfReservations&&p(gs).listOfReservations.length>0?(a(),l("div",as,[v("h1",null,[D(" Passengers "),h(k,{icon:p(ws)===p(gs).id?"lucide:chevron-up":"lucide:chevron-down",circle:"",small:"",onClick:o[5]||(o[5]=e=>xs(p(gs)))},null,8,["icon"])]),p(ws)===p(gs).id?(a(),l("div",ls,[p(ks)?(a(),P(j,{key:0,size:"tiny",indeterminate:"",class:"my-2"})):p(Ds).length>0?(a(),l("ul",rs,[v("li",null,[(a(!0),l(f,null,y(p(Ds),(e=>(a(),P(A,{key:e.user.id},{content:g((()=>[v("div",ns,[v("div",os,[v("p",null,r(e.user.userDetail?.firstName+" "+e.user.userDetail?.lastName),1),v("p",null,r(e.user.email),1),v("p",null,r(e.user.phoneNumber),1)]),v("div",us,[v("p",null,[D(" Amount : "),v("b",ds,r(p(z)(e.reservation.amountPerSeat??0)),1)]),v("p",null,[D(" Seat : "),v("b",cs," 0"+r(e.reservation.numberOfSeat??0),1)]),v("p",null,[D(" Total : "),v("b",ms,r(p(z)(e.reservation.totalAmount??0)),1)])])])])),default:g((()=>[h(c,{squared:"",size:"medium",class:"is-passenger mr-1","v-tooltip":`${e.user.userDetail?.lastName} ${e.user.userDetail?.firstName}`,initials:`${e.user.userDetail?.lastName?.[0]||""}${e.user.userDetail?.firstName?.[0]||""}`.trim()||"NA",picture:e.user.profilePhoto?.photo?`data:image/jpeg;base64,${e.user.profilePhoto.photo}`:void 0},null,8,["v-tooltip","initials","picture"])])),_:2},1024)))),128))])])):p(ks)||0!==p(Ds).length?b("",!0):(a(),l("p",vs," No passengers found for this trip. "))])):b("",!0)])):b("",!0)])])),action:g((()=>[])),_:1},8,["open"])):b("",!0)]))])}}});"function"==typeof U&&U(ps);export{ps as default};
