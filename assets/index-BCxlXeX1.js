import{_ as e}from"./VAvatar.vue_vue_type_style_index_0_lang-A1XDdLuK.js";import{_ as t}from"./VModal.vue_vue_type_style_index_0_lang-DpzmKgD9.js";import{_ as a}from"./VLoader.vue_vue_type_style_index_0_lang-CaAf6-TF.js";import{_ as s}from"./VFlexPagination.vue_vue_type_script_setup_true_lang-B_KnP90u.js";import{_ as l}from"./VPlaceholderPage.vue_vue_type_style_index_0_lang-Dg8IbSZ2.js";import{_ as i}from"./VButton.vue_vue_type_style_index_0_lang-5A9YLZjy.js";import{e as r,r as n,Q as o,o as u,w as d,t as c,v as m,x as p,Y as y,a4 as v,m as f,j as h,R as g,S as _,H as b,I as w,A as P,y as S,L as k,J as D,a5 as C,z as T}from"./index-DS7wE-jD.js";import{_ as x,a as I}from"./search-1-dark-DV4mRi9_.js";import{u as j}from"./useNotyf-BdZ2Z_wX.js";import{u as N}from"./viewWrapper-C2STndyf.js";import{u as O}from"./defaultResource-BoNHVbB6.js";import{_ as A}from"./VTag.vue_vue_type_style_index_0_lang-Ccs_Zx16.js";import{f as z,a as L,T as R,r as M,b as F}from"./common-DaPMhcAK.js";import{D as J}from"./datetime-xmklhC0O.js";import{Q as $}from"./main-C00gnokb.js";import{b as U}from"./route-block-B_A1xBdJ.js";import"./VFlex.vue_vue_type_style_index_0_lang-B3O-4R9P.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";import"./notyf-B8_S_SnG.js";import"./useFetch-BWOPolYv.js";const V={class:"list-view-toolbar"},E={class:"search-widget",style:{width:"200px"}},B={class:"field"},Y={class:"control"},H=["disabled"],G=[p("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:search"},null,-1)],Q={class:"is-profile_tabs"},W=["onClick"],q={class:"date-picker"},X={class:"page-content-inner"},K=p("img",{class:"light-image",src:x,alt:""},null,-1),Z=p("img",{class:"dark-image",src:I,alt:""},null,-1),ee={key:1,class:"is-list_view"},te=p("div",{class:"is-list_header"},[p("div",{class:"is-list_header-item",style:{width:"15%"}}," Driver "),p("div",{class:"is-list_header-item",style:{width:"10%"}}," Itinerary "),p("div",{class:"is-list_header-item",style:{width:"10%"}}," DateTime "),p("div",{class:"is-list_header-item",style:{width:"5%"}}," Nbr "),p("div",{class:"is-list_header-item",style:{width:"10%"}}," Type "),p("div",{class:"is-list_header-item",style:{width:"10%"}}," Trip "),p("div",{class:"is-list_header-item",style:{width:"5%"}}," Canc "),p("div",{class:"is-list_header-item",style:{width:"5%"}}," Rfund "),p("div",{class:"is-list_header-item",style:{width:"7%"}}," PaySta "),p("div",{class:"is-list_header-item",style:{width:"10%","text-align":"center"}}," Profit "),p("div",{class:"is-list_header-item",style:{width:"10%"}}," Due Date ")],-1),ae={class:"is-list_line-item is-user",style:{width:"15%"}},se={class:"is-user_metadata"},le={class:"has-text-primary is-underlined"},ie={class:"is-list_line-item",style:{width:"10%"}},re={class:"is-list_line-item",style:{width:"10%"}},ne={class:"is-list_line-item",style:{width:"5%"}},oe=["onClick"],ue={class:"is-list_line-item",style:{width:"10%"}},de={style:{"font-size":"0.75rem"}},ce={class:"is-list_line-item",style:{width:"10%"}},me={style:{"font-size":"0.85rem"}},pe={class:"is-list_line-item",style:{width:"5%"}},ye={style:{"font-size":"0.75rem"}},ve={class:"is-list_line-item",style:{width:"5%"}},fe={style:{"font-size":"0.75rem"}},he={class:"is-list_line-item",style:{width:"7%"}},ge={key:0,class:"tags"},_e={style:{"font-size":"0.75rem"}},be=p("small",{style:{"font-size":"0.75rem"}}," NA ",-1),we={class:"is-list_line-item",style:{width:"10%","text-align":"center"}},Pe={style:{"font-size":"0.85rem","text-align":"center"},class:"ml-2"},Se={class:"is-list_line-item",style:{width:"10%"}},ke={key:0},De={class:"card-list-item"},Ce={class:"info"},Te={class:"somme"},xe={class:"amounts"},Ie={class:"amount"},je={class:"d-flex"},Ne=p("b",{class:"label"},"Number of seats :",-1),Oe={class:"money"},Ae=p("b",{class:"label"},"Trip :",-1),ze={class:"money"},Le=p("b",{class:"label"},"Booking fees :",-1),Re={key:0,class:"money"},Me=p("b",{class:"label"},"taxes :",-1),Fe={class:"money"},Je={class:"amount"},$e={class:"d-flex"},Ue=p("b",{class:"label"},"Onbudged :",-1),Ve={key:0,class:"bull"},Ee={key:1,class:"bull"},Be=p("p",null,[p("b",{class:"label"},"Coupon :"),p("b",{class:"money"}," - ")],-1),Ye=p("b",{class:"label"},"Refund :",-1),He={key:0,class:"money"},Ge={key:1,class:"money"},Qe=p("b",{class:"label"},"Payment Statut :",-1),We={key:0,class:"money"},qe={key:1,class:"money"},Xe={class:"total"},Ke=p("b",{class:"label"},"Paid :",-1),Ze={key:0,class:"money"},et={key:0,class:"total"},tt=p("b",{class:"label"},"Refund :",-1),at={key:0,class:"moneyrefund"},st={key:1,class:"moneyrefund"},lt={key:2,class:"moneyrefund"},it={key:1,class:"total"},rt=p("b",{class:"label"},"Refund :",-1),nt={key:0,class:"moneyrefund"},ot={class:"total"},ut=p("b",{class:"label"},"Canceled :",-1),dt={key:0,class:"bull"},ct={key:1,class:"bull"},mt=p("br",null,null,-1),pt={key:0,class:"is-pc_body"},yt={class:"travel"},vt=p("span",null,"Depart",-1),ft=p("i",{class:"iconify has-text-primary","aria-hidden":"true","data-icon":"solar:map-point-bold-duotone"},null,-1),ht=p("span",null,"ArrivÃ©e",-1),gt=p("i",{class:"iconify has-text-success","aria-hidden":"true","data-icon":"solar:map-point-bold-duotone"},null,-1),_t=p("div",{class:"is-dest_elt_divider"},null,-1),bt={key:1},wt=[p("p",{class:"has-text-centered"}," No passengers found for this trip. ",-1)],Pt=r({__name:"index",setup(r){const x=N(),I=O(),U=["All","Pending","Completed"],Pt=n(""),St=n(!1),kt=n({currentPage:1,perPage:9,total:0}),Dt=n("All"),Ct=n([]),Tt=n(!1),xt=n([]),It=n(!1),jt=n(""),Nt=j(),Ot=n(null),At=n(""),zt=n(""),Lt=n([new Date("2025-01-01"),new Date("2025-12-31")]),Rt=n(null),Mt=n([]),Ft=n(!1),Jt=e=>{const t=J.fromISO(e).plus({hours:6});return J.now()>t},$t=e=>{kt.value.currentPage=e},Ut=async()=>{if(!Ot.value)return Nt.error("Error: No refund selected for update."),void(It.value=!1);const e={id:Ot.value.id,journeyId:Ot.value.journeyId,refundStatus:zt.value,paiementStatus:At.value,userId:Ot.value.userId};St.value=!0;try{await I.edit("/Refund/Update",e)&&(Nt.success("Refund status updated successfully!"),await Yt())}catch(t){Nt.error(`Error updating refund status: ${t.message||"Unknown error"}`),console.error("Error during refund status update:",t)}finally{It.value=!1,St.value=!1,Ot.value=null,At.value="",zt.value=""}},Vt=o((()=>{let e=Ct.value.filter((e=>e.user));if(e=e.filter((e=>"All"===Dt.value?"00000000-0000-0000-0000-000000000000"==e.parentId&&null==e.listOfReservations.childDriverJourneyId:"Pending"===Dt.value?"1"===e.status&&!Jt(e.travelingDate):"Completed"!==Dt.value||("2"===e.status||Jt(e.travelingDate)))),Lt.value&&Lt.value[0]&&Lt.value[1]){const t=J.fromJSDate(Lt.value[0]).startOf("day"),a=J.fromJSDate(Lt.value[1]).endOf("day");e=e.filter((e=>{const s=J.fromISO(e.travelingDate);return s>=t&&s<=a}))}if(Pt.value&&Pt.value.trim().length>0){const t=Pt.value.trim().toLowerCase();e=e.filter((e=>e.user?.userDetail?.firstName?.toLowerCase().includes(t)||e.user?.userDetail?.lastName?.toLowerCase().includes(t)||e.user?.email?.toLowerCase().includes(t)||e.departurePoint?.city?.toLowerCase().includes(t)||e.departurePoint?.address?.toLowerCase().includes(t)||e.destinationPoint?.city?.toLowerCase().includes(t)||e.refundData?.refundStatus?.toLowerCase().includes(t)||e.refundData?.paiementStatus?.toLowerCase().includes(t)||e.id.toLowerCase().includes(t)||e.destinationPoint?.address?.toLowerCase().includes(t)))}kt.value.total=e.length;const t=(kt.value.currentPage-1)*kt.value.perPage,a=t+kt.value.perPage;return e.slice(t,a)})),Et=()=>{Tt.value=!1,Mt.value=[],Rt.value=null,Ft.value=!1,xt.value=[]},Bt=e=>{let t=0;return e&&e.listOfReservations&&e.listOfReservations.forEach((e=>{const a=J.fromISO(e.travelingDate),s=J.fromISO(e.creationDate),l=a.diff(s,"hours").hours;if("1"===e.isCanceled){const a=(e.amountPerSeat-1.695-.0396*e.amountPerSeat)*e.numberOfSeat;t+=a}if("0"===e.isCanceled&&l>=12&&l<24){const a=(e.amountPerSeat/2-1.695-e.amountPerSeat/2*.0396)*e.numberOfSeat;t+=a}if("0"===e.isCanceled&&l<12){const a=(e.amountPerSeat-1.695-.0396*e.amountPerSeat)*e.numberOfSeat;t+=a}})),z(t)},Yt=async()=>{St.value=!0;try{const e=await I.list("/DriverJourney/GetAllJourney");if(!e||!Array.isArray(e))return Ct.value=[],void(kt.value.total=0);const t=[...new Set(e.map((e=>e.userId)).filter((e=>null!=e)))].map((e=>Ht(e))),a=await Promise.all(t),s=e.map((e=>(async e=>{if(e.id&&e.userId){const t=await I.list("/Refund/GetByUserIdAndJourneyId?driverid="+e.userId+"&journeyid="+e.id);if(t&&Array.isArray(t)||console.log("No data found"),Array.isArray(t)&&t.length>0)return t}return[]})(e))),l=await Promise.all(s),i=new Map;a.forEach((e=>{e&&e.id&&i.set(e.id,e)}));const r=new Map;e.forEach(((e,t)=>{const a=l[t];a&&a.length>0&&r.set(e.id,a)}));const n=e.map((e=>{const t=i.get(e.userId),a=r.get(e.id)||[];return{...e,refundData:a,user:t||null}}));Ct.value=n,kt.value.total=n.length}catch(e){console.error("An error has occurred: ",e)}finally{St.value=!1}},Ht=async e=>{try{return await I.listUser(`/User/FindUserById?userid=${e}`)}catch(t){return console.error(`Error fetching user ${e}: `,t),null}};return u((async()=>{x.setPageTitle("List of Journeys"),await Yt()})),d([Lt,Dt,Pt],(()=>{kt.value.currentPage=1})),(r,n)=>{const o=i,u=l,d=s,x=a,j=t,N=e;return c(),m("div",null,[p("div",V,[p("div",E,[p("div",B,[p("div",Y,[y(p("input",{"onUpdate:modelValue":n[0]||(n[0]=e=>h(Pt)?Pt.value=e:null),type:"text",class:"input",placeholder:"Rechercher..."},null,512),[[v,f(Pt)]]),p("button",{class:"search-button",disabled:f(Pt).length<1},G,8,H)])])]),p("ul",Q,[(c(),m(g,null,_(U,((e,t)=>p("li",{key:t,class:P([e===f(Dt)&&"is-active_tab","is-p_tab"]),onClick:t=>Dt.value=e},S(e),11,W))),64))]),p("div",q,[b(f($),{modelValue:f(Lt),"onUpdate:modelValue":n[1]||(n[1]=e=>h(Lt)?Lt.value=e:null),"model-auto":"",range:"","time-picker":!1,class:"date-picker-value",locale:"en"},null,8,["modelValue"])]),b(o,{icon:"lucide:refresh-cw",color:"danger",onClick:Yt},{default:w((()=>[k(" Refresh ")])),_:1})]),b(x,{active:f(St)},{default:w((()=>[p("div",X,[0===f(Vt).length?(c(),D(u,{key:0,title:"We couldn't find any matching results.",subtitle:"Too bad. Looks like we couldn't find any matching results for the\n              filter terms you've entered. Please try different filter terms or\n              criteria.",larger:""},{image:w((()=>[K,Z])),_:1})):(c(),m("div",ee,[te,(c(!0),m(g,null,_(f(Vt),(e=>{return c(),m("div",{key:e.id,class:"is-list_line"},[p("div",ae,[p("div",se,[p("h3",null,S(`${e.user?.userDetail?.lastName} ${e.user?.userDetail?.firstName}`),1),p("p",null,S((t=e.user?.email,a=18,t?t.length>a?t.slice(0,a)+"...":t:"")),1),p("p",le,S(e.user?.phoneNumber),1)])]),p("div",ie,[p("p",null,"from "+S(e?.departurePoint?.city??"City"),1),p("p",null,"to "+S(e?.destinationPoint?.city??"City"),1)]),p("div",re,[p("p",null,S(f(J).fromISO(e.travelingDate).toFormat("dd/MM/yy")),1),p("p",null,[p("small",null,[p("b",null,S(f(J).fromISO(e.travelingDate).toFormat("hh:mm a")),1)])])]),p("div",ne,[p("span",{style:C(e.maxSeats-e.avalableSeets>0?"cursor: pointer;":"cursor: default;"),onClick:t=>e.maxSeats-e.avalableSeets>0?(async e=>{if(Tt.value=!0,Rt.value===e.id)Rt.value=null,Mt.value=[];else if(Rt.value=e.id,Mt.value=[],Ft.value=!0,e&&e.listOfReservations&&e.listOfReservations.length>0)try{const t=e.listOfReservations.map((async e=>{if(e.userId&&e.childDriverJourneyId)try{const t=await I.list(`/User/FindUserById?userid=${e.userId}`),a=await I.list("/Refund/GetByUserIdAndJourneyId?driverid="+e.userId+"&journeyid="+e.childDriverJourneyId);if(t&&a){const s=e.childDriverJourneyId?Ct.value.find((t=>t.id===e.childDriverJourneyId)):null;return{user:t,reservation:e,childTrip:s,refundMoney:a}}}catch(t){return console.error(`Error fetching user ${e.userId} for reservation ${e.id}:`,t),[]}else Tt.value=!1,Nt.warning("This trip do not have reservation for now");return[]})),a=(await Promise.all(t)).filter((e=>null!==e));Mt.value=a,Ft.value=!1}catch(t){console.error(`Error fetching passenger details for trip ${e.id}:`,t),Mt.value=[]}finally{Ft.value=!1}else Mt.value=[],Ft.value=!1})(e):null},S(e.maxSeats-e.avalableSeets),13,oe)]),p("div",ue,[b(A,{size:"tiny",style:{width:"fit-content","line-height":"1.6",display:"flex"},color:e.isPaiementCash?"success":"info"},{default:w((()=>[p("small",de,S(e.isPaiementCash?"cash":"in-app"),1)])),_:2},1032,["color"])]),p("div",ce,[p("b",me,S(f(z)(e.amountPerSeet)),1)]),p("div",pe,[b(A,{size:"tiny",style:{width:"fit-content","line-height":"1.6",display:"flex"},color:"1"===e.status?"success":"warning"},{default:w((()=>[p("small",ye,S("1"===e.status?"No":"Yes"),1)])),_:2},1032,["color"])]),p("div",ve,[(c(!0),m(g,null,_(e.refundData,(e=>(c(),m("div",{key:e.id,class:"tags"},[b(A,{size:"tiny",style:{width:"fit-content","line-height":"1.6",display:"flex"},color:"NA"===e?.refundStatus?"info":"Yes"===e?.refundStatus?"success":"No"===e?.refundStatus?"primary":"warning"},{default:w((()=>[p("small",fe,S(e?.refundStatus),1)])),_:2},1032,["color"])])))),128))]),p("div",he,[e.refundData?(c(),m("div",ge,[(c(!0),m(g,null,_(e.refundData,(e=>(c(),D(A,{key:e.id,size:"tiny",style:{width:"fit-content","line-height":"1.6",display:"flex",cursor:"pointer"},color:"NA"===e?.paiementStatus?"info":"Paid"===e?.paiementStatus?"success":"Locked"===e?.paiementStatus?"primary":"warning",onClick:t=>((e,t,a)=>{let s="",l="",i=!1;"Hold"===t&&"Paid"!==e?(s="Paid",l="Yes",i=!0):"NA"===t&&"Hold"===e&&(s="Paid",l="NA",i=!0),i?(Ot.value=a,At.value=s,zt.value=l,jt.value=e,It.value=!0):Nt.warning("No actionable status change for:",e,t)})(e?.paiementStatus,e?.refundStatus,e)},{default:w((()=>[p("small",_e,S(e?.paiementStatus),1)])),_:2},1032,["color","onClick"])))),128))])):(c(),D(A,{key:1,size:"tiny",style:{width:"fit-content","line-height":"1.6",display:"flex"},color:"info"},{default:w((()=>[be])),_:1}))]),p("div",we,[b(A,{color:Bt(e).length>1?"success":"danger",size:"tiny"},{default:w((()=>[p("b",Pe,S(Bt(e)),1)])),_:2},1032,["color"])]),p("div",Se,[p("p",null,[p("b",null,S(f(J).fromISO(e.travelingDate).plus({days:5}).toFormat("dd/MM/yy")),1)])])]);var t,a})),128))])),b(d,{"current-page":f(kt).currentPage,"onUpdate:currentPage":[n[2]||(n[2]=e=>f(kt).currentPage=e),$t],"item-per-page":f(kt).perPage,"total-items":f(kt).total,"max-links-displayed":7,"no-router":""},null,8,["current-page","item-per-page","total-items"])])])),_:1},8,["active"]),b(j,{title:"Change Status payement",open:f(It),actions:"center",size:"small",onClose:n[3]||(n[3]=e=>It.value=!1)},{content:w((()=>[p("p",null,[k(" The actual payement status is : "),b(A,{size:"tiny",color:"Hold"===f(jt)?"warning":"danger",style:{"line-height":"1.6",display:"flex"}},{default:w((()=>[k(S(f(jt)),1)])),_:1},8,["color"]),k(". Do want to change it to "),b(A,{color:"success"},{default:w((()=>[k(" Paid ")])),_:1}),k("? ")])])),action:w((()=>[b(o,{color:"primary",raised:"",loading:f(St),onClick:Ut},{default:w((()=>[k(" Confirm ")])),_:1},8,["loading"])])),_:1},8,["open"]),b(j,{open:f(Tt),actions:"center",title:"List of Passengers",noclose:"",noaction:"",size:"medium",noscroll:!1,onClose:Et},{content:w((()=>[b(x,{active:1==f(Ft),text:f(Ft)?"Loading passengers...":"",translucent:!0},{default:w((()=>[f(Mt)&&f(Mt).length>0?(c(),m("div",ke,[(c(!0),m(g,null,_(f(Mt),(e=>(c(),m("ul",{key:e.user.id,class:"card"},[p("li",De,[p("div",Ce,[b(N,{initials:`${e.user.userDetail?.lastName?.[0]||""}${e.user.userDetail?.firstName?.[0]||""}`.trim()||"NA",picture:e.user.profilePhoto?.photo?`data:image/jpeg;base64,${e.user.profilePhoto.photo}`:void 0,size:"xl",squared:"",to:`/app/carpoolers/${e.user.id}`},null,8,["initials","picture","to"]),p("span",null,S(e.user.userDetail?.firstName+" "+e.user.userDetail?.lastName),1),p("span",null,S(e.user.email),1)]),p("div",Te,[p("div",xe,[p("div",Ie,[p("div",je,[p("p",null,[Ne,p("b",Oe," 0"+S(e.reservation.numberOfSeat??0),1)]),p("p",null,[Ae,p("b",ze,S(f(z)(e.reservation.amountPerSeat??0)),1)]),p("p",null,[Le,e.childTrip?(c(),m("b",Re,S(f(L)(e.childTrip.amountPerSeet??0,.175)),1)):T("",!0)]),p("p",null,[Me,p("b",Fe,S(f(L)(e.reservation.amountPerSeat??0,.13)),1)])])]),p("div",Je,[p("div",$e,[p("p",null,[Ue,e.childTrip&&e.childTrip.amountPerSeet!==e.reservation.amountPerSeat&&e.childTrip?(c(),m("b",Ve," Yes ")):(c(),m("b",Ee," No "))]),Be,p("p",null,[Ye,e.reFundMoney&&e.reFundMoney.length<0?(c(),m("b",He," - ")):(c(),m("b",Ge,[(c(!0),m(g,null,_(e.reFundMoney,(e=>(c(),m("span",{key:e.id},S(e?.refundStatus),1)))),128))]))]),p("p",null,[Qe,e.reFundMoney&&e.reFundMoney.length<0?(c(),m("b",We," - ")):(c(),m("b",qe,[(c(!0),m(g,null,_(e.reFundMoney,(e=>(c(),m("span",{key:e.id},S(e?.paiementStatus),1)))),128))]))])])])]),p("p",Xe,[Ke,e.childTrip?(c(),m("b",Ze,S(f(R)(e.childTrip.amountPerSeet??0,e.reservation.numberOfSeat)),1)):T("",!0)]),!1===e.childTrip.isPaiementCash&&e.childTrip?(c(),m("p",et,[tt,e.childTrip&&"paid"===f(M)(e.childTrip.travelingDate,e.childTrip.creationDate)&&"0"===e.reservation.isCanceled?(c(),m("b",at," -"+S(f(R)(e.childTrip.amountPerSeet??0,e.reservation.numberOfSeat)),1)):T("",!0),e.childTrip&&"refunded"===f(M)(e.childTrip.travelingDate,e.childTrip.creationDate)&&"0"===e.reservation.isCanceled?(c(),m("b",st," -"+S(f(z)(e.reservation.totalAmount/2)),1)):T("",!0),e.childTrip&&"no refund"===f(M)(e.childTrip.travelingDate,e.childTrip.creationDate)&&"0"===e.reservation.isCanceled?(c(),m("b",lt," 0 ")):T("",!0)])):T("",!0),e.childTrip&&!0===e.childTrip.isPaiementCash&&"0"===e.reservation.isCanceled?(c(),m("p",it,[rt,e.childTrip&&"paid"===f(M)(e.childTrip.travelingDate,e.childTrip.creationDate)?(c(),m("b",nt,S(f(F)(e.childTrip.amountPerSeet??0,e.reservation.numberOfSeat)),1)):T("",!0)])):T("",!0),p("p",ot,[ut,"1"===e.reservation.isCanceled?(c(),m("b",dt," No ")):(c(),m("b",ct,[k(" Yes"),mt,k(" "+S(f(J).fromISO(e.childTrip.travelingDate).toFormat("dd/MM/yy hh:mm a")),1)]))])])]),e.childTrip?(c(),m("li",pt,[p("div",yt,[p("h4",null,[vt,ft,k(" "+S(e.childTrip.departurePoint.city??"City"),1)]),p("h4",null,[ht,gt,k(" "+S(e.childTrip.destinationPoint.city??"City"),1)])]),_t])):T("",!0)])))),128))])):T("",!0),f(Mt)&&0===f(Mt).length&&0==f(Ft)?(c(),m("div",bt,wt)):T("",!0)])),_:1},8,["active","text"])])),_:1},8,["open"])])}}});"function"==typeof U&&U(Pt);export{Pt as default};
