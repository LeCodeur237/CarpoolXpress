import{_ as e}from"./VModal.vue_vue_type_style_index_0_lang-DpzmKgD9.js";import{_ as a}from"./VField.vue_vue_type_script_setup_true_lang-Dwb550Cl.js";import{_ as l}from"./VControl-O2V3df4R.js";import{_ as s}from"./VInput.vue_vue_type_script_setup_true_lang-Dk8R7Jld.js";import{_ as r}from"./VIcon.vue_vue_type_script_setup_true_lang-DbqCAdy3.js";import{_ as o}from"./VButton.vue_vue_type_style_index_0_lang-5A9YLZjy.js";import{_ as t}from"./VAvatar.vue_vue_type_style_index_0_lang-A1XDdLuK.js";import{e as n,r as i,o as u,t as d,v as c,x as p,H as m,m as f,y as v,A as w,z as h,I as _,a1 as y,a2 as g,L as P,Y as N,a4 as b}from"./index-DS7wE-jD.js";import{u as V}from"./viewWrapper-C2STndyf.js";import{u as C}from"./defaultResource-BoNHVbB6.js";import{u as k}from"./useNotyf-BdZ2Z_wX.js";import{b as U}from"./route-block-B_A1xBdJ.js";import{_ as x}from"./_plugin-vue_export-helper-BCo6x5W8.js";import"./useFetch-BWOPolYv.js";import"./notyf-B8_S_SnG.js";const j=e=>(y("data-v-5d211182"),e=e(),g(),e),I={class:"account-wrapper"},B={class:"columns"},O={class:"column is-4"},D={class:"account-box is-navigation"},F={class:"media-flex-center"},z={class:"flex-meta"},A=j((()=>p("div",{class:"flex-end"},null,-1))),E={class:"account-menu"},G=[j((()=>p("i",{"aria-hidden":"true",class:"lnil lnil-user-alt"},null,-1))),j((()=>p("span",null,"General",-1))),j((()=>p("span",{class:"end rtl-reflect"},[p("i",{"aria-hidden":"true",class:"fas fa-arrow-right"})],-1)))],S=[j((()=>p("i",{"aria-hidden":"true",class:"lnil lnil-cog"},null,-1))),j((()=>p("span",null,"Update password",-1))),j((()=>p("span",{class:"end rtl-reflect"},[p("i",{"aria-hidden":"true",class:"fas fa-arrow-right"})],-1)))],T={class:"column is-8"},$={class:"account-box is-form is-footerless"},L={class:"form-head stuck-header"},R={class:"form-head-inner"},q={class:"left"},H={key:0},W={key:1},M={key:2},X={key:3},Y={class:"right"},J={class:"buttons"},K=j((()=>p("i",{"aria-hidden":"true",class:"lnir lnir-arrow-left rem-100"},null,-1))),Q=j((()=>p("span",null," Save Changes ",-1))),Z={class:"form-body"},ee={key:0},ae={class:"fieldset"},le=j((()=>p("div",{class:"fieldset-heading"},[p("h4",null,"Profile Picture"),p("p",null,"This is how others will recognize you")],-1))),se={class:"v-avatar is-xl profile-v-avatar"},re={type:"button",class:"button edit-button is-edit is-circle is-dark-bg-1",tabindex:"0"},oe={class:"icon"},te={class:"fieldset"},ne=j((()=>p("div",{class:"fieldset-heading"},[p("h4",null,"Personal Info"),p("p",null,"Others deserve to know you more")],-1))),ie={class:"columns is-multiline"},ue={class:"column is-12"},de={class:"column is-12"},ce={class:"column is-12"},pe={key:1,class:"fieldset"},me=j((()=>p("div",{class:"fieldset-heading"},[p("h4",null,"Change Password"),p("p",null,"For an improved account security")],-1))),fe={class:"columns is-multiline"},ve={class:"column is-12"},we={class:"column is-12"},he={class:"column is-12"},_e=n({__name:"edit-user",setup(n){const y=V(),g=C(),U=k(),x=i(!1),j=i(!1),_e=i(!1),ye=localStorage.getItem("cpx--logger_ID"),ge=i({fullName:"",phoneNumber:"",dateOfBirth:"",password:""}),Pe=i({oldPassword:"",newPassword:"",repeatNewPassword:""}),Ne=async()=>{if(ye){j.value=!0;try{const e=await g.find("/ConsoleUser/GetById",`?userid=${ye}`);e?(ge.value.fullName=e.userDetailConsole?.fullName||"",ge.value.email=e.email||"",ge.value.password=e.password||"",ge.value.phoneNumber=e.phoneNumber||"",ge.value.dateOfBirth=e.userDetailConsole?.dateOfBirth?new Date(e.userDetailConsole.dateOfBirth).toISOString().split("T")[0]:""):U.error("Failed to fetch user data.")}catch(e){U.error(`Error fetching user data: ${e.message||"Unknown error"}`),console.error("Error fetching user data:",e)}finally{j.value=!1}}else U.error("User ID not found. Cannot load profile.")},be=async()=>{j.value=!0;try{if(x.value){const e=(()=>{const e=Pe.value;return e.newPassword?e.newPassword.length<8?"New password must be at least 8 characters long.":e.newPassword!==e.repeatNewPassword?"New passwords do not match.":null:"Please enter a new password."})();if(e)return U.warning(e),void(j.value=!1);const a={email:ge.value.email,password:Pe.value.newPassword},l="/ConsoleUser/RessetPassword",s=await g.editPassword(l,a);s?(U.success(s.message||"Password updated successfully!"),Pe.value.oldPassword="",Pe.value.newPassword="",Pe.value.repeatNewPassword="",x.value=!1):console.error("Password update failed (handled in store).")}else{const e=(()=>{const e=ge.value;return e.fullName.trim()?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e.email)?e.phoneNumber.trim()?e.dateOfBirth?null:"Please select a date of birth.":"Please enter a phone number.":"Please enter a valid email address.":"Please enter a full name."})();if(e)return U.warning(e),void(j.value=!1);if(!ye)return U.error("User ID is missing. Cannot update profile."),void(j.value=!1);const a={id:ye,email:ge.value.email,password:ge.value.password,phoneNumber:ge.value.phoneNumber.trim(),userDetailConsole:{fullName:ge.value.fullName.trim(),dateOfBirth:ge.value.dateOfBirth}},l="/ConsoleUser/UpdateUser",s=await g.edit(l,a);s?(U.success("Profile updated successfully!"),_e.value=!1,await Ne()):(U.error("Failed to update profile. API returned unsuccessful."),console.error("API call to update profile was unsuccessful:",s))}}catch(e){U.error(`An unexpected error occurred: ${e.message||"Unknown error"}`),console.error("Error during save changes:",e)}finally{j.value=!1}},Ve=e=>{x.value=e,e||(Pe.value.oldPassword="",Pe.value.newPassword="",Pe.value.repeatNewPassword="")};return u((async()=>{y.setPageTitle("Edit Profile"),await Ne()})),(n,i)=>{const u=t,y=o,g=r,V=s,C=l,k=a,U=e;return d(),c("div",I,[p("div",B,[p("div",O,[p("div",D,[p("div",F,[m(u,{size:"large",initials:f(ge).fullName[1]+f(ge).fullName[2]||"",squared:""},null,8,["initials"]),p("div",z,[p("span",null,v(f(ge).fullName||"Loading..."),1),p("span",null,v(f(ge).email||"Loading..."),1)]),A]),p("div",E,[p("a",{"aria-current":"page",class:w(["account-menu-item",!f(x)&&"router-link-active"]),onClick:i[0]||(i[0]=e=>Ve(!1))},G,2),p("a",{class:w(["account-menu-item",f(x)&&"router-link-active"]),onClick:i[1]||(i[1]=e=>Ve(!0))},S,2)])])]),p("div",T,[p("div",$,[p("div",L,[p("div",R,[p("div",q,[f(x)?h("",!0):(d(),c("h3",H," General Info ")),f(x)?h("",!0):(d(),c("p",W," Edit your account's general information ")),f(x)?(d(),c("h3",M," Change Password ")):h("",!0),f(x)?(d(),c("p",X," Update your account security ")):h("",!0)]),p("div",Y,[p("div",J,[m(y,{to:"/app/settings"},{default:_((()=>[K,P(" Go Back ")])),_:1}),m(y,{class:"button button v-button is-raised is-primary",raised:"",loading:f(j),disabled:f(j),onClick:i[2]||(i[2]=e=>_e.value=!0)},{default:_((()=>[Q])),_:1},8,["loading","disabled"])])])])]),p("div",Z,[f(x)?h("",!0):(d(),c("div",ee,[p("div",ae,[le,p("div",se,[m(u,{initials:f(ge).fullName[1]+f(ge).fullName[2]||"CP",size:"xl",squared:""},null,8,["initials"]),p("button",re,[p("span",oe,[m(g,{class:"iconify",icon:"lucide:edit-2"})])]),p("input",{ref:"fileInput",type:"file",style:{display:"none"},accept:"image/*",onChange:i[3]||(i[3]=(...e)=>n.handleFileChange&&n.handleFileChange(...e))},null,544)])]),p("div",te,[ne,p("div",ie,[p("div",ue,[m(k,null,{default:_((()=>[m(C,{icon:"lucide:user"},{default:_((()=>[m(V,{modelValue:f(ge).fullName,"onUpdate:modelValue":i[4]||(i[4]=e=>f(ge).fullName=e),type:"text",placeholder:"Full name"},null,8,["modelValue"])])),_:1})])),_:1})]),p("div",de,[m(k,null,{default:_((()=>[m(C,{icon:"lucide:phone"},{default:_((()=>[m(V,{modelValue:f(ge).phoneNumber,"onUpdate:modelValue":i[5]||(i[5]=e=>f(ge).phoneNumber=e),type:"tel",placeholder:"Phone number"},null,8,["modelValue"])])),_:1})])),_:1})]),p("div",ce,[m(k,null,{default:_((()=>[m(C,{icon:"lucide:calendar-days"},{default:_((()=>[N(p("input",{"onUpdate:modelValue":i[6]||(i[6]=e=>f(ge).dateOfBirth=e),class:"input",type:"date",placeholder:"Date of birthday"},null,512),[[b,f(ge).dateOfBirth]])])),_:1})])),_:1})])])])])),f(x)?(d(),c("div",pe,[me,p("div",fe,[p("div",ve,[m(k,null,{default:_((()=>[m(C,{icon:"lucide:lock"},{default:_((()=>[m(V,{modelValue:f(Pe).newPassword,"onUpdate:modelValue":i[7]||(i[7]=e=>f(Pe).newPassword=e),type:"password",placeholder:"New Password"},null,8,["modelValue"])])),_:1})])),_:1})]),p("div",we,[m(k,null,{default:_((()=>[m(C,{icon:"lucide:lock"},{default:_((()=>[m(V,{modelValue:f(Pe).repeatNewPassword,"onUpdate:modelValue":i[8]||(i[8]=e=>f(Pe).repeatNewPassword=e),type:"password",placeholder:"Repeat New Password"},null,8,["modelValue"])])),_:1})])),_:1})])])])):h("",!0)])])]),m(U,{open:f(_e),size:"small",actions:"center",title:"Confirm the update",onClose:i[11]||(i[11]=e=>_e.value=!1)},{content:_((()=>[p("div",he,[m(k,null,{default:_((()=>[m(C,{icon:"lucide:lock"},{default:_((()=>[m(V,{modelValue:f(ge).password,"onUpdate:modelValue":i[9]||(i[9]=e=>f(ge).password=e),type:"password",placeholder:"Password"},null,8,["modelValue"])])),_:1})])),_:1})])])),action:_((()=>[m(y,{color:"primary",raised:"",onClick:i[10]||(i[10]=e=>be())},{default:_((()=>[P(" Update your informations ")])),_:1})])),_:1},8,["open"])])])}}});"function"==typeof U&&U(_e);const ye=x(_e,[["__scopeId","data-v-5d211182"]]);export{ye as default};
