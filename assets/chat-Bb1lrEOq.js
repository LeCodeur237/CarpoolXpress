import{_ as s}from"./_plugin-vue_export-helper-BCo6x5W8.js";import{t as e,v as a,M as i,e as t,r as l,x as n,m as d,Y as o,a4 as r,P as c,H as u,I as p,o as m,z as v,R as g,S as f,A as h,y,a1 as b,a2 as w}from"./index-BmU4ZD6R.js";import{u as _}from"./useDropdown-C_v0bt44.js";import{u as k}from"./defaultResource-D_X989iq.js";import{u as j}from"./viewWrapper-Ca5MwF68.js";import{a as I,b as C}from"./common-CvuSpKng.js";import{b as x}from"./route-block-B_A1xBdJ.js";import"./useNotyf-C4Q0if2M.js";import"./notyf-CBduEkA9.js";import"./useFetch-BNEmLZ4H.js";import"./datetime-xmklhC0O.js";const S={class:"chat-body-wrap"};const U=s({},[["render",function(s,t){return e(),a("div",S,[i(s.$slots,"default")])}]]),D={id:"chat-body",class:"chat-body"};const W=s({},[["render",function(s,t){return e(),a("ol",D,[i(s.$slots,"default")])}]]),M={class:"message-field-wrapper"},F={class:"control"},P={class:"add-content"},$=[n("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:plus"},null,-1)],A=n("div",{class:"dropdown-menu",role:"menu"},[n("div",{class:"dropdown-content"},[n("a",{class:"dropdown-item"},[n("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:video"}),n("div",{class:"meta"},[n("span",null,"Video"),n("span",null,"Embed a video")])]),n("a",{href:"#",class:"dropdown-item kill-drop v-modal-trigger"},[n("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:image"}),n("div",{class:"meta"},[n("span",null,"Images"),n("span",null,"Upload pictures")])]),n("a",{href:"#",class:"dropdown-item kill-drop v-modal-trigger"},[n("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:link"}),n("div",{class:"meta"},[n("span",null,"Link"),n("span",null,"Post a link")])]),n("hr",{class:"dropdown-divider"}),n("a",{href:"#",class:"dropdown-item kill-drop v-modal-trigger"},[n("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:file"}),n("div",{class:"meta"},[n("span",null,"File"),n("span",null,"Upload a file")])])])],-1),G=n("div",{class:"add-emoji"},[n("div",{class:"button"},[n("i",{"aria-hidden":"true",class:"iconify","data-icon":"feather:smile"})])],-1),H=n("div",{class:"typing-indicator"},[n("img",{src:"/images/icons/misc/typing.gif",alt:""})],-1),K=t({__name:"ChatMessageFieldWrapper",emits:["send"],setup(s,{emit:i}){const t=l(),u=_(t),p=l(""),m=i,v=()=>{const s=p.value.trim();s&&(m("send",s),p.value="")};return(s,i)=>(e(),a("div",M,[n("div",F,[n("div",P,[n("div",{ref_key:"dropdownElement",ref:t,class:"dropdown dropdown-trigger is-up"},[n("div",null,[n("div",{class:"button","aria-haspopup":"true",onClick:i[0]||(i[0]=(...s)=>d(u).toggle&&d(u).toggle(...s))},$)]),A],512)]),G,o(n("input",{id:"chat-input",class:"input is-rounded",type:"text",placeholder:"Write a message ...","aria-label":"Write a message","onUpdate:modelValue":i[1]||(i[1]=s=>p.value=s),onKeyup:c(v,["enter"])},null,544),[[r,p.value]]),n("div",{class:"send-message"},[n("div",{class:"button v-button is-primary is-raised is-rounded",onClick:v}," Send ")])]),H]))}}),O={class:"is-chat animated preFadeInUp fadeInUp"},R=t({__name:"ChatCard",emits:["send"],setup(s,{emit:t}){const l=t;return(s,t)=>{const n=W,d=U;return e(),a("div",O,[u(d,null,{default:p((()=>[u(n,null,{default:p((()=>[i(s.$slots,"body")])),_:3}),i(s.$slots,"side")])),_:3}),u(K,{onSend:t[0]||(t[0]=s=>l("send",s))})])}}}),z=s=>(b("data-v-0ad97677"),s=s(),w(),s),E={class:"is-chat_container"},N={key:0,class:"no-messages"},V=[z((()=>n("img",{class:"light-image",src:"/assets/search-5-Uh5GWafy.svg",alt:""},null,-1))),z((()=>n("img",{class:"dark-image",src:"/assets/search-5-dark-Dj4jz-Pw.svg",alt:""},null,-1))),z((()=>n("div",{class:"text"},[n("h3",null,"Aucun message visible"),n("p",null," Sélectionner une conversation pour commencer à répondre aux besoins ")],-1)))],Y={class:"is-message_list"},L=[z((()=>n("div",{class:"loader is-loading"},null,-1)))],T={class:"is-chat_side"},q=["onKeydown","onClick"],B={class:"is-chat_sender"},J={class:"is-chat_sub"},Q=t({__name:"chat",emits:["toggleMobileConversation"],setup(s,{emit:i}){const t=j(),o=k(),r=l([]),b=l(),w=l([]),_=l(),x=l(!1),S=async()=>{try{x.value=!0;const s=await o.list("/HelpDesk/GetAllMessages");if(s&&s.length>0){const e=s.reduce(((s,e)=>(s[e.clientId]=s[e.clientId]||[],s[e.clientId].push(e),s)),{});w.value=e,r.value=s}}catch(s){console.log("an error has occured: ",s)}finally{x.value=!1}},U=async s=>{_.value=s;const e=Object.values(w.value)[s];b.value=I(e)},D=async s=>{const e="00000000-0000-0000-0000-000000000000",a={id:e,clientId:b.value?.at(0)?.clientId??e,message:s,consoleUserId:"00000000-0000-0000-0000-000000000001",sendingDate:(new Date).toISOString(),isRead:!0};await o.add("HelpDesk/SendMessage",a)&&(await S(),b&&U(_.value??0))},W=s=>"00000000-0000-0000-0000-000000000000"===s.consoleUserId?"is-received":"is-sended";return m((async()=>{t.setPageTitle("Chat"),await S()})),(s,i)=>{const t=R;return e(),a("div",E,[u(t,{onSend:D},{body:p((()=>[d(b)?v("",!0):(e(),a("li",N,V)),n("div",Y,[(e(!0),a(g,null,f(d(b),(s=>(e(),a("li",{key:s.id,class:h(["is-message_elt",W(s)])},y(s.message),3)))),128))]),n("li",{class:h(["chat-loader",[d(x)&&"is-active"]])},L,2)])),side:p((()=>[n("div",T,[(e(!0),a(g,null,f(Object.values(d(w)),((s,i)=>(e(),a("div",{key:i,class:h(["is-chat_elt",s.at(-1).clientId===d(b)?.at(0)?.clientId&&"active"]),tabindex:"0",role:"button",onKeydown:[c((s=>U(i)),["enter"]),c((s=>U(i)),["space"])],onClick:s=>U(i)},[n("h3",B,y(s.at(-1).clientId),1),n("span",J,y(d(C)(s.at(-1).message,60)),1)],42,q)))),128))])])),_:1})])}}});"function"==typeof x&&x(Q);const X=s(Q,[["__scopeId","data-v-0ad97677"]]);export{X as default};
